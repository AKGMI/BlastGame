window.__require=function e(t,o,i){function n(s,a){if(!o[s]){if(!t[s]){var c=s.split("/");if(c=c[c.length-1],!t[c]){var u="function"==typeof __require&&__require;if(!a&&u)return u(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+s+"'")}s=c}var l=o[s]={exports:{}};t[s][0].call(l.exports,function(e){return n(t[s][1][e]||e)},l,l.exports,e,t,o,i)}return o[s].exports}for(var r="function"==typeof __require&&__require,s=0;s<i.length;s++)n(i[s]);return n}({AnimationService:[function(e,t,o){"use strict";cc._RF.push(t,"480f8B1a1FIJ6+qseJe9nwF","AnimationService");var i=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))(function(n,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},n=this&&this.__generator||function(e,t){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(a){r=[6,a],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0}),o.AnimationService=void 0;var r=e("../../core/EventBus"),s=e("../../shared/constants/ZIndexConstants"),a=function(){function e(){this._isProcessing=!1,this.animationLayer=null,this.configs={tileRemoval:{duration:.25,easing:"sineOut"},tileMove:{duration:.15,easing:"bounceOut"},tileSpawn:{duration:.4,easing:"backOut"},tileSwap:{duration:.6,easing:"sineInOut"},superTileCreate:{duration:.6,easing:"backOut"},shuffle:{duration:1.2,easing:"sineInOut"}},this.eventBus=r.EventBus.getInstance(),this.createAnimationLayer()}return e.prototype.createAnimationLayer=function(){this.animationLayer=new cc.Node("AnimationLayer"),this.animationLayer.zIndex=s.ZIndexConstants.ANIMATIONS;var e=cc.find("Canvas");if(e){e.addChild(this.animationLayer);var t=e.getContentSize();this.animationLayer.setContentSize(t),this.animationLayer.setPosition(0,0)}},e.prototype.moveToAnimationLayer=function(e,t){if(!this.animationLayer)return t;var o=e.parent.convertToWorldSpaceAR(t),i=this.animationLayer.convertToNodeSpaceAR(o);return e.parent=this.animationLayer,e.position=i,i},e.prototype.convertToAnimationLayerSpace=function(e,t){if(!this.animationLayer)return t;var o=e.convertToWorldSpaceAR(t);return this.animationLayer.convertToNodeSpaceAR(o)},e.prototype.returnFromAnimationLayer=function(e,t,o){e.parent=t,e.position=o,this.resetNodeState(e)},e.prototype.resetNodeState=function(e){e.scale=1,e.opacity=255,e.angle=0,e.active=!0},Object.defineProperty(e.prototype,"isProcessing",{get:function(){return this._isProcessing},enumerable:!1,configurable:!0}),e.prototype.animateTileRemoval=function(e,t,o){return i(this,void 0,Promise,function(){return n(this,function(i){switch(i.label){case 0:this._isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.performTileRemoval(e,t,o)];case 2:return i.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateTileMovement=function(e,t,o){return i(this,void 0,Promise,function(){return n(this,function(i){switch(i.label){case 0:this._isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.performTileMovement(e,t,o)];case 2:return i.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateTileSpawn=function(e,t,o){return i(this,void 0,Promise,function(){return n(this,function(i){switch(i.label){case 0:this._isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.performTileSpawn(e,t,o)];case 2:return i.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateSuperTileCreation=function(e){return i(this,void 0,Promise,function(){return n(this,function(t){switch(t.label){case 0:this._isProcessing=!0,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.performSuperTileCreation(e)];case 2:return t.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateSwap=function(e,t){return i(this,void 0,Promise,function(){var o=this;return n(this,function(i){switch(i.label){case 0:this._isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,new Promise(function(i){if(!e||e.length<2||!t||t.length<2)i();else{var n=e[0],r=e[1],s=t[0],a=t[1];(null==n?void 0:n.isValid)&&(null==r?void 0:r.isValid)?o.performAdvancedSwap(n,r,s,a,function(){return i()}):i()}})];case 2:return i.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateBoardShuffle=function(e,t,o){return i(this,void 0,Promise,function(){return n(this,function(i){switch(i.label){case 0:this._isProcessing=!0,i.label=1;case 1:return i.trys.push([1,,3,4]),[4,this.performBoardShuffle(e,t,o)];case 2:return i.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateSequence=function(e){return i(this,void 0,Promise,function(){var t,o;return n(this,function(i){switch(i.label){case 0:this._isProcessing=!0,i.label=1;case 1:i.trys.push([1,,6,7]),t=0,o=e,i.label=2;case 2:return t<o.length?[4,(0,o[t])()]:[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return[3,7];case 6:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 7:return[2]}})})},e.prototype.animateInvalidMove=function(e){return i(this,void 0,Promise,function(){return n(this,function(t){switch(t.label){case 0:this._isProcessing=!0,t.label=1;case 1:return t.trys.push([1,,3,4]),[4,this.performInvalidMoveAnimation(e)];case 2:return t.sent(),[3,4];case 3:return this._isProcessing=!1,this.eventBus.publish(r.GameEvents.ANIMATION_COMPLETED),[7];case 4:return[2]}})})},e.prototype.animateHint=function(e){return i(this,void 0,Promise,function(){return n(this,function(){return[2,this.performHintAnimation(e)]})})},e.prototype.stopHintAnimation=function(e){e.forEach(function(e){e&&e.isValid&&(cc.Tween.stopAllByTarget(e),e.scale=1,e.opacity=255)})},e.prototype.performTileRemoval=function(e,t,o){return i(this,void 0,Promise,function(){var i=this;return n(this,function(){return[2,new Promise(function(n){if(t&&0!==t.length){var r=o||i.findExplosionCenter(e),s=0,a=function(){++s>=t.length&&n()};t.forEach(function(t,o){if(t&&t.isValid){var n=e[o];if(n){var s=i.calculateDistance(r,n);setTimeout(function(){cc.tween(t).parallel(cc.tween().to(i.configs.tileRemoval.duration,{scale:1.6,opacity:0},{easing:cc.easing.sineOut}),cc.tween().by(i.configs.tileRemoval.duration,{angle:540})).call(function(){i.resetNodeState(t),t.active=!1,a()}).start()},80*s)}else a()}else a()})}else n()})]})})},e.prototype.findExplosionCenter=function(e){if(0===e.length)return{row:0,col:0};var t=e.reduce(function(e,t){return e+t.row},0),o=e.reduce(function(e,t){return e+t.col},0);return{row:Math.round(t/e.length),col:Math.round(o/e.length)}},e.prototype.calculateDistance=function(e,t){return Math.abs(e.row-t.row)+Math.abs(e.col-t.col)},e.prototype.generateColumnDelay=function(e){return.15*Math.random()+e%3*.05},e.prototype.performTileMovement=function(e,t,o){return i(this,void 0,Promise,function(){return n(this,function(){return[2,new Promise(function(i){if(t&&0!==t.length){var n=0,r=function(){++n>=t.length&&i()};t.forEach(function(t,i){if(t&&t.isValid&&o[i]){var n=o[i],s=e[i],a=s?s.to.row-s.from.row:1,c=Math.min(.25,.12+.025*a);setTimeout(function(){cc.tween(t).to(.8*c,{position:n},{easing:cc.easing.sineIn}).to(.2*c,{scale:1.05}).to(.1*c,{scale:1}).call(r).start()},12*i)}else r()})}else i()})]})})},e.prototype.performTileSpawn=function(e,t,o){return i(this,void 0,Promise,function(){var i=this;return n(this,function(){return[2,new Promise(function(n){if(t&&0!==t.length){var r=0,s=function(){++r>=t.length&&n()},a=new Map;t.forEach(function(t,i){var n=o[i],r=e[i];if(t&&t.isValid&&n&&r){var c=r.col;a.has(c)||a.set(c,[]),a.get(c).push({node:t,targetPos:n,tile:r,originalIndex:i})}else s()});var c=0;a.forEach(function(e){e.sort(function(e,t){return t.tile.row-e.tile.row});var t=i.generateColumnDelay(c);c++,e.forEach(function(e,o){var i=e.node,n=e.targetPos,r=e.tile,a=Math.max(1,r.row+10),c=n.y+60*a+80;i.position=cc.v3(n.x,c,0),i.opacity=255,i.scale=1,i.active=!0;var u=Math.min(.25,.12+.025*a);setTimeout(function(){cc.tween(i).to(.8*u,{position:n},{easing:cc.easing.sineIn}).to(.2*u,{scale:1.05}).to(.1*u,{scale:1}).call(s).start()},1e3*(t+.015*o))})})}else n()})]})})},e.prototype.performSuperTileCreation=function(e){return i(this,void 0,Promise,function(){return n(this,function(){return[2,new Promise(function(t){if(e&&e.isValid){var o=e.scale;cc.tween(e).to(.08,{scale:.8}).to(.15,{scale:1.4},{easing:cc.easing.backOut}).to(.12,{scale:o},{easing:cc.easing.sineInOut}).parallel(cc.tween().by(.06,{angle:15}),cc.tween().delay(.06).by(.06,{angle:-30}),cc.tween().delay(.12).by(.06,{angle:15})).call(function(){e.angle=0,t()}).start()}else t()})]})})},e.prototype.performAdvancedSwap=function(e,t,o,i,n){var r=this,s=e.parent,a=t.parent,c=e.position.clone(),u=t.position.clone(),l=this.moveToAnimationLayer(e,c),p=this.moveToAnimationLayer(t,u),h=this.convertToAnimationLayerSpace(s,o),f=this.convertToAnimationLayerSpace(a,i),v=(l.x+p.x)/2,d=(l.y+p.y)/2+60,g=0,y=function(){2==++g&&n()};cc.tween(e).parallel(cc.tween().to(.25,{position:cc.v3(v-30,d,0),scale:1.2},{easing:cc.easing.sineOut}),cc.tween().by(.25,{angle:180})).parallel(cc.tween().by(.1,{angle:90}),cc.tween().to(.1,{scale:1.1})).parallel(cc.tween().to(.3,{position:h,scale:1},{easing:cc.easing.backOut}),cc.tween().by(.3,{angle:90})).call(function(){r.returnFromAnimationLayer(e,s,o),y()}).start(),setTimeout(function(){cc.tween(t).parallel(cc.tween().to(.25,{position:cc.v3(v+30,d,0),scale:1.2},{easing:cc.easing.sineOut}),cc.tween().by(.25,{angle:-180})).parallel(cc.tween().by(.1,{angle:-90}),cc.tween().to(.1,{scale:1.1})).parallel(cc.tween().to(.3,{position:f,scale:1},{easing:cc.easing.backOut}),cc.tween().by(.3,{angle:-90})).call(function(){r.returnFromAnimationLayer(t,a,i),y()}).start()},50)},e.prototype.performBoardShuffle=function(e,t,o){return i(this,void 0,Promise,function(){var i=this;return n(this,function(){return[2,new Promise(function(n){e&&0!==e.length?i.performAdvancedShuffle(e,t,o,n):n()})]})})},e.prototype.performAdvancedShuffle=function(e,t,o,i){var n=this,r=cc.find("Canvas"),s=r?r.convertToWorldSpaceAR(cc.v3(0,0,0)):cc.v3(0,0,0),a=this.animationLayer.convertToNodeSpaceAR(s),c=e.map(function(e,i){var n=e.parent,r=e.position.clone();return{node:e,originalParent:n,originalPos:r,targetPos:o[i],newType:t[i],index:i,animPos:cc.v3(0,0,0)}}),u=0,l=c.length;c.forEach(function(e){var t=n.moveToAnimationLayer(e.node,e.originalPos);e.animPos=t}),c.forEach(function(e,t){var o=t/l*Math.PI*8,r=30+t%4*15,s=a.x+Math.cos(o)*r,c=a.y+Math.sin(o)*r,p=n.convertToAnimationLayerSpace(e.originalParent,e.targetPos);setTimeout(function(){cc.tween(e.node).parallel(cc.tween().to(.3,{position:cc.v3(s,c,0),scale:.5,opacity:150},{easing:cc.easing.sineOut}),cc.tween().by(.3,{angle:360})).call(function(){var t=e.node.getComponent("TileView");t&&t.setType&&void 0!==e.newType&&t.setType(e.newType)}).by(.4,{angle:720},{easing:cc.easing.sineInOut}).parallel(cc.tween().to(.35,{position:p,scale:1,opacity:255},{easing:cc.easing.backOut}),cc.tween().by(.35,{angle:360})).call(function(){n.returnFromAnimationLayer(e.node,e.originalParent,e.targetPos),e.node.angle=0,++u>=l&&i()}).start()},15*t)})},e.prototype.performInvalidMoveAnimation=function(e){return i(this,void 0,Promise,function(){return n(this,function(){return[2,new Promise(function(t){if(e&&0!==e.length){var o=0,i=function(){++o>=e.length&&t()};e.forEach(function(e){if(e&&e.isValid){var t=e.position.clone();setTimeout(function(){cc.tween(e).to(.05,{position:cc.v3(t.x-8,t.y,t.z)}).to(.05,{position:cc.v3(t.x+8,t.y,t.z)}).to(.05,{position:cc.v3(t.x-6,t.y,t.z)}).to(.05,{position:cc.v3(t.x+6,t.y,t.z)}).to(.05,{position:cc.v3(t.x-4,t.y,t.z)}).to(.05,{position:cc.v3(t.x+4,t.y,t.z)}).to(.05,{position:t}).call(function(){i()}).start()},0)}else i()})}else t()})]})})},e.prototype.performHintAnimation=function(e){return i(this,void 0,Promise,function(){return n(this,function(){return[2,new Promise(function(t){e&&0!==e.length?(e.forEach(function(e){e&&e.isValid&&setTimeout(function(){var t=cc.tween(e).to(.6,{scale:.9},{easing:cc.easing.sineInOut}).to(.6,{scale:1},{easing:cc.easing.sineInOut});cc.tween(e).repeatForever(t).start()},1e3)}),t()):t()})]})})},e.prototype.destroy=function(){this.animationLayer&&this.animationLayer.isValid&&(this.animationLayer.destroy(),this.animationLayer=null)},e}();o.AnimationService=a,cc._RF.pop()},{"../../core/EventBus":"EventBus","../../shared/constants/ZIndexConstants":"ZIndexConstants"}],BaseSuperTile:[function(e,t,o){"use strict";cc._RF.push(t,"ad289ALB5JB6KUilPNhIaQo","BaseSuperTile");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.BaseSuperTile=void 0;var r=e("../base/BaseTile"),s=e("../../../shared/utils/TileUtils"),a=function(e){function t(t,o,i){void 0===i&&(i=20);var n=e.call(this,t,o)||this;return n.pointsPerTile=i,n}return n(t,e),t.prototype.canActivate=function(){return!0},t.prototype.activate=function(e){var t=this.getTargets(e),o=t.length*this.pointsPerTile,i=this.findAffectedSuperTiles(e,t);return{removed:t,points:o,affectedSuperTiles:i.length>0?i:void 0}},t.prototype.findAffectedSuperTiles=function(e,t){for(var o=[],i=0,n=t;i<n.length;i++){var r=n[i];if(r.row!==this.position.row||r.col!==this.position.col){var a=e.getTile(r.row,r.col);a&&s.TileUtils.isSuperTile(a.type)&&o.push({row:r.row,col:r.col,type:a.type})}}return o},t}(r.BaseTile);o.BaseSuperTile=a,cc._RF.pop()},{"../../../shared/utils/TileUtils":"TileUtils","../base/BaseTile":"BaseTile"}],BaseTile:[function(e,t,o){"use strict";cc._RF.push(t,"46de9LzXddCOb6tkcMrG3Jt","BaseTile");var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.BaseTile=void 0;var n=function(){function e(e,t){this.type=e,this._position=t}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},enumerable:!1,configurable:!0}),e.prototype.setPosition=function(e){this._position=i({},e)},e}();o.BaseTile=n,cc._RF.pop()},{}],BoardView:[function(e,t,o){"use strict";cc._RF.push(t,"71d00FxtORIiroY3ChQUXyI","BoardView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s},s=this&&this.__awaiter||function(e,t,o,i){return new(o||(o=Promise))(function(n,r){function s(e){try{c(i.next(e))}catch(t){r(t)}}function a(e){try{c(i.throw(e))}catch(t){r(t)}}function c(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o(function(e){e(t)})).then(s,a)}c((i=i.apply(e,t||[])).next())})},a=this&&this.__generator||function(e,t){var o,i,n,r,s={label:0,sent:function(){if(1&n[0])throw n[1];return n[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(e){return function(t){return c([e,t])}}function c(r){if(o)throw new TypeError("Generator is already executing.");for(;s;)try{if(o=1,i&&(n=2&r[0]?i.return:r[0]?i.throw||((n=i.return)&&n.call(i),0):i.next)&&!(n=n.call(i,r[1])).done)return n;switch(i=0,n&&(r=[2&r[0],n.value]),r[0]){case 0:case 1:n=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,i=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(n=(n=s.trys).length>0&&n[n.length-1])&&(6===r[0]||2===r[0])){s=0;continue}if(3===r[0]&&(!n||r[1]>n[0]&&r[1]<n[3])){s.label=r[1];break}if(6===r[0]&&s.label<n[1]){s.label=n[1],n=r;break}if(n&&s.label<n[2]){s.label=n[2],s.ops.push(r);break}n[2]&&s.ops.pop(),s.trys.pop();continue}r=t.call(e,s)}catch(a){r=[6,a],i=0}finally{o=n=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(o,"__esModule",{value:!0});var c=e("./TileView"),u=e("../../core/EventBus"),l=e("../../core/GameServiceContainer"),p=cc._decorator,h=p.ccclass,f=p.property,v=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tilePrefab=null,t.tileSize=100,t.tileSpacing=0,t.boardPadding=50,t.tileViews=[],t.boardRows=0,t.boardCols=0,t}return n(t,e),t.prototype.onLoad=function(){this.eventBus=u.EventBus.getInstance();var e=l.GameServiceContainer.getGameInstance();this.animationService=e.getAnimationService(),this.coordinateService=e.getCoordinateService(),this.swapVisualService=e.getSwapVisualService(),this.setupEventListeners(),this.setupTileClickHandler(),this.setupSwapVisualService()},t.prototype.setupEventListeners=function(){this.eventBus.subscribe(u.GameEvents.MOVE_COMPLETED,this.handleMoveCompleted,this),this.eventBus.subscribe(u.UICommands.SHUFFLE_REQUESTED,this.handleShuffleAnimation,this),this.eventBus.subscribe(u.UICommands.HINT_ANIMATION_START,this.handleHintStart,this),this.eventBus.subscribe(u.UICommands.HINT_ANIMATION_STOP,this.handleHintStop,this),this.eventBus.subscribe(u.UICommands.BOARD_INIT,this.handleBoardInit,this)},t.prototype.setupTileClickHandler=function(){this.node.on("tile-clicked",this.onTileClicked,this)},t.prototype.onTileClicked=function(e){var t=e.getUserData();this.eventBus.publish(u.GameEvents.TILE_CLICKED,t.row,t.col)},t.prototype.setupSwapVisualService=function(){var e=this;this.swapVisualService.setTileViewProvider(function(t,o){var i;return null===(i=e.tileViews[t])||void 0===i?void 0:i[o]})},t.prototype.getTileNode=function(e,t){var o,i,n=null===(o=this.tileViews[e])||void 0===o?void 0:o[t];return(null===(i=null==n?void 0:n.node)||void 0===i?void 0:i.isValid)?n.node:null},t.prototype.createTileNode=function(e,t,o){var i=cc.instantiate(this.tilePrefab);this.node.addChild(i);var n=i.getComponent(c.default);this.tileViews[e]||(this.tileViews[e]=[]),this.tileViews[e][t]=n,i.width=this.tileSize,i.height=this.tileSize,i.zIndex=this.boardRows-e,n.setType(o),n.setGridPosition(e,t);var r=this.getTilePosition(e,t);return i.position=cc.v3(r.x,r.y,0),i},t.prototype.removeTileNode=function(e,t){var o,i=null===(o=this.tileViews[e])||void 0===o?void 0:o[t];i&&(i.node.active=!1,this.tileViews[e][t]=null)},t.prototype.moveTileNode=function(e,t,o,i){var n,r=null===(n=this.tileViews[e])||void 0===n?void 0:n[t];if(r){this.tileViews[o][i]=r,this.tileViews[e][t]=null;var s=this.getTilePosition(o,i);r.node.position=cc.v3(s.x,s.y,0),r.node.zIndex=this.boardRows-o,r.setGridPosition(o,i)}},t.prototype.swapTileNodes=function(e,t){var o,i,n=null===(o=this.tileViews[e.row])||void 0===o?void 0:o[e.col],r=null===(i=this.tileViews[t.row])||void 0===i?void 0:i[t.col];n&&r?(this.tileViews[e.row][e.col]=r,this.tileViews[t.row][t.col]=n,n.setGridPosition(t.row,t.col),r.setGridPosition(e.row,e.col),n.node.zIndex=this.boardRows-t.row,r.node.zIndex=this.boardRows-e.row):console.error("[BoardView] \u274c \u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b TileView \u0434\u043b\u044f swap")},t.prototype.updateBoardSize=function(){var e=2*this.boardPadding+this.boardCols*this.tileSize+(this.boardCols-1)*this.tileSpacing,t=2*this.boardPadding+this.boardRows*this.tileSize+(this.boardRows-1)*this.tileSpacing;this.node.width=e,this.node.height=t},t.prototype.getTilePosition=function(e,t){var o=this.node.width,i=this.node.height,n=-o/2+this.boardPadding+this.tileSize/2,r=-i/2+this.boardPadding+this.tileSize/2,s=n+t*(this.tileSize+this.tileSpacing),a=r+(this.boardRows-1-e)*(this.tileSize+this.tileSpacing);return cc.v2(s,a)},t.prototype.handleBoardInit=function(e){this.initializeBoard(e.rows,e.cols,e.getTileType)},t.prototype.handleMoveCompleted=function(e){var t=e.moveResult;t?this.animateWithService(t).catch(function(e){console.error("[BoardView] \u274c \u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u0440\u0438 \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u0438\u0438 \u0430\u043d\u0438\u043c\u0430\u0446\u0438\u0439:",e)}):console.error("[BoardView] \u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445 moveResult \u0432 \u0441\u043e\u0431\u044b\u0442\u0438\u0438")},t.prototype.handleShuffleAnimation=function(e){e.boardData&&this.animateShuffleWithService(e.boardData.getTileType)},t.prototype.animateShuffleWithService=function(e){return s(this,void 0,Promise,function(){var t,o,i,n,r,s,c;return a(this,function(a){switch(a.label){case 0:for(t=[],o=[],i=[],n=0;n<this.boardRows;n++)for(r=0;r<this.boardCols;r++)(s=this.getTileNode(n,r))&&(t.push(s),o.push(e(n,r)),c=this.getTilePosition(n,r),i.push(cc.v3(c.x,c.y,0)));return[4,this.animationService.animateBoardShuffle(t,o,i)];case 1:return a.sent(),this.updateTileTypes(e),[2]}})})},t.prototype.animateWithService=function(e){var t,o,i,n,r;return s(this,void 0,Promise,function(){var s,c,u=this;return a(this,function(a){switch(a.label){case 0:return s=[],0===(null===(t=e.removed)||void 0===t?void 0:t.length)&&0===e.points&&(null===(o=e.clickedGroup)||void 0===o?void 0:o.length)>0?[4,this.animateInvalidMoveGroup(e.clickedGroup)]:[3,2];case 1:return a.sent(),[2];case 2:return(null===(i=e.removed)||void 0===i?void 0:i.length)>0&&s.push(function(){return u.animateRemoval(e.removed,e.explosionCenter)}),e.superTile&&s.push(function(){return u.animateSuperTile(e.superTile)}),(null===(n=e.movedTiles)||void 0===n?void 0:n.length)>0&&s.push(function(){return u.animateMovement(e.movedTiles)}),(null===(r=e.newTiles)||void 0===r?void 0:r.length)>0&&(c=e.newTiles.filter(function(e){return void 0!==e.type}),s.push(function(){return u.animateSpawn(c)})),e.swappedTile&&s.push(function(){return u.animateSwap(e.swappedTile)}),0===s.length?[2]:[4,this.animationService.animateSequence(s)];case 3:return a.sent(),[2]}})})},t.prototype.animateRemoval=function(e,t){return s(this,void 0,Promise,function(){var o,i=this;return a(this,function(n){switch(n.label){case 0:return o=e.map(function(e){return i.getTileNode(e.row,e.col)}).filter(function(e){return null!==e}),[4,this.animationService.animateTileRemoval(e,o,t)];case 1:return n.sent(),e.forEach(function(e){i.removeTileNode(e.row,e.col)}),[2]}})})},t.prototype.animateMovement=function(e){return s(this,void 0,Promise,function(){var t,o,i=this;return a(this,function(n){switch(n.label){case 0:return t=[],o=[],e.forEach(function(e){var n=i.getTileNode(e.from.row,e.from.col);if(n){t.push(n);var r=i.getTilePosition(e.to.row,e.to.col);o.push(cc.v3(r.x,r.y,0))}}),[4,this.animationService.animateTileMovement(e,t,o)];case 1:return n.sent(),e.forEach(function(e){i.moveTileNode(e.from.row,e.from.col,e.to.row,e.to.col)}),[2]}})})},t.prototype.animateSpawn=function(e){return s(this,void 0,Promise,function(){var t,o,i=this;return a(this,function(n){switch(n.label){case 0:return t=[],o=[],e.forEach(function(e){var n=i.createTileNode(e.row,e.col,e.type);t.push(n);var r=i.getTilePosition(e.row,e.col);o.push(cc.v3(r.x,r.y,0))}),[4,this.animationService.animateTileSpawn(e,t,o)];case 1:return n.sent(),[2]}})})},t.prototype.animateSwap=function(e){return s(this,void 0,Promise,function(){var t,o,i,n,r,s;return a(this,function(a){switch(a.label){case 0:return t=this.getTileNode(e.pos1.row,e.pos1.col),o=this.getTileNode(e.pos2.row,e.pos2.col),t&&o?(i=this.getTilePosition(e.pos2.row,e.pos2.col),n=this.getTilePosition(e.pos1.row,e.pos1.col),r=[t,o],s=[cc.v3(i.x,i.y,0),cc.v3(n.x,n.y,0)],[4,this.animationService.animateSwap(r,s)]):[3,2];case 1:return a.sent(),this.swapTileNodes(e.pos1,e.pos2),[3,3];case 2:console.error("[BoardView] \u274c \u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b \u043d\u043e\u0434\u044b \u0434\u043b\u044f swap"),a.label=3;case 3:return[2]}})})},t.prototype.animateSuperTile=function(e){var t;return s(this,void 0,Promise,function(){var o,i;return a(this,function(n){switch(n.label){case 0:return e.type?(o=this.createTileNode(e.row,e.col,e.type),[4,this.animationService.animateSuperTileCreation(o)]):(console.error("[BoardView] \u274c \u0422\u0438\u043f \u0441\u0443\u043f\u0435\u0440\u0442\u0430\u0439\u043b\u0430 \u043d\u0435 \u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d"),[2]);case 1:return n.sent(),(i=null===(t=this.tileViews[e.row])||void 0===t?void 0:t[e.col])&&i.setType(e.type),[2]}})})},t.prototype.initializeBoard=function(e,t,o){this.boardRows=e,this.boardCols=t,this.updateBoardSize(),this.coordinateService.setGameBoard(this.node,this.tileSize,e,t),this.clearBoard(),this.createTileGrid(),this.updateTileTypes(o)},t.prototype.clearBoard=function(){this.node.removeAllChildren(),this.tileViews=[]},t.prototype.createTileGrid=function(){this.tileViews=[];for(var e=0;e<this.boardRows;e++){this.tileViews[e]=[];for(var t=0;t<this.boardCols;t++){var o=cc.instantiate(this.tilePrefab),i=o.getComponent(c.default);if(i){i.setGridPosition(e,t),this.tileViews[e][t]=i;var n=this.getTilePosition(e,t);o.setPosition(n.x,n.y),o.width=this.tileSize,o.height=this.tileSize,this.node.addChild(o),o.zIndex=this.boardRows-e}}}},t.prototype.updateTileTypes=function(e){for(var t=0;t<this.boardRows;t++)for(var o=0;o<this.boardCols;o++){var i=this.tileViews[t][o];if(i){var n=e(t,o);i.setType(n)}}},t.prototype.handleHintStart=function(e){var t=this,o=e.positions||e;if(o&&o.length>0){var i=o.map(function(e){return t.getTileNode(e.row,e.col)}).filter(function(e){return null!==e});i.length>0&&this.animationService.animateHint(i)}},t.prototype.handleHintStop=function(){for(var e=[],t=0;t<this.boardRows;t++)for(var o=0;o<this.boardCols;o++)e.push(this.getTileNode(t,o));this.animationService.stopHintAnimation(e)},t.prototype.animateInvalidMoveGroup=function(e){return s(this,void 0,Promise,function(){var t,o=this;return a(this,function(i){switch(i.label){case 0:return(t=e.map(function(e){return o.getTileNode(e.row,e.col)}).filter(function(e){return null!==e})).length>0?[4,this.animationService.animateInvalidMove(t)]:[3,2];case 1:i.sent(),i.label=2;case 2:return[2]}})})},t.prototype.onDestroy=function(){this.eventBus&&(this.eventBus.unsubscribe(u.GameEvents.MOVE_COMPLETED,this.handleMoveCompleted,this),this.eventBus.unsubscribe(u.UICommands.SHUFFLE_REQUESTED,this.handleShuffleAnimation,this),this.eventBus.unsubscribe(u.UICommands.HINT_ANIMATION_START,this.handleHintStart,this),this.eventBus.unsubscribe(u.UICommands.HINT_ANIMATION_STOP,this.handleHintStop,this),this.eventBus.unsubscribe(u.UICommands.BOARD_INIT,this.handleBoardInit,this)),this.node.off("tile-clicked",this.onTileClicked,this)},r([f(cc.Prefab)],t.prototype,"tilePrefab",void 0),r([f(cc.Float)],t.prototype,"tileSize",void 0),r([f(cc.Float)],t.prototype,"tileSpacing",void 0),r([f],t.prototype,"boardPadding",void 0),r([h],t)}(cc.Component);o.default=v,cc._RF.pop()},{"../../core/EventBus":"EventBus","../../core/GameServiceContainer":"GameServiceContainer","./TileView":"TileView"}],BombBoosterStrategy:[function(e,t,o){"use strict";cc._RF.push(t,"e2a55/DkIxNlYWs104Vrkqd","BombBoosterStrategy"),Object.defineProperty(o,"__esModule",{value:!0}),o.BombBoosterStrategy=void 0;var i=e("../BoostersTypes"),n=function(){function e(){this.type=i.BoosterType.BOMB}return e.prototype.canActivate=function(e,t){return e.isValidPosition(t.row,t.col)},e.prototype.activate=function(e,t){if(!this.canActivate(e,t))return{success:!1,needsSecondClick:!1};var o=this.getExplosionTargets(e,t);return{success:!0,needsSecondClick:!1,removed:o,points:o.length,explosionCenter:t}},e.prototype.needsSecondClick=function(){return!1},e.prototype.getHintMessage=function(){return"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0442\u0430\u0439\u043b \u0434\u043b\u044f \u0432\u0437\u0440\u044b\u0432\u0430"},e.prototype.reset=function(){},e.prototype.getExplosionTargets=function(e,t){for(var o=[],i=t.row-1;i<=t.row+1;i++)for(var n=t.col-1;n<=t.col+1;n++)e.isValidPosition(i,n)&&o.push({row:i,col:n});return o},e}();o.BombBoosterStrategy=n,cc._RF.pop()},{"../BoostersTypes":"BoostersTypes"}],BoosterInventory:[function(e,t,o){"use strict";cc._RF.push(t,"a0731SlTS9B86zsKKKp1KSQ","BoosterInventory"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterInventory=void 0;var i=e("../../features/boosters/BoostersTypes"),n=function(){function e(){this.inventory=new Map,this.initializeInventory()}return e.prototype.initializeInventory=function(){this.inventory.set(i.BoosterType.BOMB,3),this.inventory.set(i.BoosterType.SWAP,3)},e.prototype.hasBooster=function(e){return(this.inventory.get(e)||0)>0},e.prototype.getBoosterCount=function(e){return this.inventory.get(e)||0},e.prototype.addBoosters=function(e,t){var o=this.inventory.get(e)||0;this.inventory.set(e,o+t)},e.prototype.consumeBooster=function(e){var t=this.inventory.get(e)||0;return t>0&&(this.inventory.set(e,t-1),!0)},e.prototype.getAllBoosterCounts=function(){var e={};return this.inventory.forEach(function(t,o){e[o]=t}),e},e.prototype.reset=function(){this.initializeInventory()},e}();o.BoosterInventory=n,cc._RF.pop()},{"../../features/boosters/BoostersTypes":"BoostersTypes"}],BoosterManager:[function(e,t,o){"use strict";cc._RF.push(t,"11ee2rB4QdJyZMhzLreNo0H","BoosterManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterManager=void 0;var i=e("../../features/boosters/BoostersTypes"),n=e("../models/BoosterInventory"),r=e("../../features/boosters/strategies/BombBoosterStrategy"),s=e("../../features/boosters/strategies/SwapBoosterStrategy"),a=function(){function e(){this.strategies=new Map,this.activeStrategy=null,this.inventory=new n.BoosterInventory,this.registerStrategies()}return e.prototype.registerStrategies=function(){this.strategies.set(i.BoosterType.BOMB,new r.BombBoosterStrategy),this.strategies.set(i.BoosterType.SWAP,new s.SwapBoosterStrategy)},e.prototype.activateBooster=function(e){if(!this.inventory.hasBooster(e))return!1;var t=this.strategies.get(e);return!!t&&(this.activeStrategy&&this.activeStrategy.reset(),this.activeStrategy=t,!0)},e.prototype.handleClick=function(e,t){if(!this.activeStrategy)return{success:!1,needsSecondClick:!1};var o=this.activeStrategy.activate(e,t);return o.success&&!o.needsSecondClick&&(this.inventory.consumeBooster(this.activeStrategy.type),this.deactivateBooster()),o},e.prototype.deactivateBooster=function(){this.activeStrategy&&(this.activeStrategy.reset(),this.activeStrategy=null)},e.prototype.getActiveBoosterType=function(){return this.activeStrategy?this.activeStrategy.type:null},e.prototype.getBoosterHint=function(){return this.activeStrategy?this.activeStrategy.getHintMessage():""},e.prototype.needsSecondClick=function(){return!!this.activeStrategy&&this.activeStrategy.needsSecondClick()},e.prototype.hasBooster=function(e){return this.inventory.hasBooster(e)},e.prototype.getBoosterCount=function(e){return this.inventory.getBoosterCount(e)},e.prototype.addBoosters=function(e,t){this.inventory.addBoosters(e,t)},e.prototype.getAllBoosterCounts=function(){return this.inventory.getAllBoosterCounts()},e.prototype.reset=function(){this.deactivateBooster(),this.inventory.reset()},e}();o.BoosterManager=a,cc._RF.pop()},{"../../features/boosters/BoostersTypes":"BoostersTypes","../../features/boosters/strategies/BombBoosterStrategy":"BombBoosterStrategy","../../features/boosters/strategies/SwapBoosterStrategy":"SwapBoosterStrategy","../models/BoosterInventory":"BoosterInventory"}],BoosterPanel:[function(e,t,o){"use strict";cc._RF.push(t,"e263akDhsxITKWAj5Zm3lyx","BoosterPanel");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../core/EventBus"),a=e("../../features/boosters/BoostersTypes"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bombButton=null,t.swapButton=null,t.bombCountLabel=null,t.swapCountLabel=null,t.activeBoosterType=null,t}return n(t,e),t.prototype.onLoad=function(){this.eventBus=s.EventBus.getInstance(),this.setupEventListeners(),this.setupButtonListeners()},t.prototype.setupEventListeners=function(){this.eventBus.subscribe(s.UICommands.UPDATE_BOOSTERS,this.onUpdateBoosters,this),this.eventBus.subscribe(s.UICommands.SET_BOOSTER_ACTIVE,this.onSetActiveBooster,this)},t.prototype.setupButtonListeners=function(){var e=this;this.bombButton?this.bombButton.node.on("click",function(){return e.onBoosterButtonClicked(a.BoosterType.BOMB)},this):console.error("[BoosterPanel] \u041a\u043d\u043e\u043f\u043a\u0430 BOMB \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430!"),this.swapButton?this.swapButton.node.on("click",function(){return e.onBoosterButtonClicked(a.BoosterType.SWAP)},this):console.error("[BoosterPanel] \u041a\u043d\u043e\u043f\u043a\u0430 SWAP \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430!")},t.prototype.onUpdateBoosters=function(e){this.bombCountLabel&&(this.bombCountLabel.string=(e[a.BoosterType.BOMB]||0).toString()),this.swapCountLabel&&(this.swapCountLabel.string=(e[a.BoosterType.SWAP]||0).toString()),this.updateButtonAvailability(e)},t.prototype.updateButtonAvailability=function(e){this.bombButton&&(this.bombButton.interactable=(e[a.BoosterType.BOMB]||0)>0),this.swapButton&&(this.swapButton.interactable=(e[a.BoosterType.SWAP]||0)>0)},t.prototype.onSetActiveBooster=function(e){this.activeBoosterType=e,this.updateButtonVisualState()},t.prototype.updateButtonVisualState=function(){this.setButtonHighlight(this.bombButton,!1),this.setButtonHighlight(this.swapButton,!1),this.activeBoosterType===a.BoosterType.BOMB?this.setButtonHighlight(this.bombButton,!0):this.activeBoosterType===a.BoosterType.SWAP&&this.setButtonHighlight(this.swapButton,!0)},t.prototype.setButtonHighlight=function(e,t){if(e){var o=e.node.parent;t?(cc.Tween.stopAllByTarget(o),o.scale=1.15,o.color=cc.Color.YELLOW,cc.tween(o).repeatForever(cc.tween().to(.3,{scale:1.2}).to(.3,{scale:1.15})).start()):(cc.Tween.stopAllByTarget(o),o.scale=1,o.color=cc.Color.WHITE)}},t.prototype.onBoosterButtonClicked=function(e){var t,o;(e===a.BoosterType.BOMB?null===(t=this.bombButton)||void 0===t?void 0:t.interactable:null===(o=this.swapButton)||void 0===o?void 0:o.interactable)?this.activeBoosterType===e?this.eventBus.publish(s.GameEvents.BOOSTER_DEACTIVATION_REQUESTED,e):this.eventBus.publish(s.GameEvents.BOOSTER_ACTIVATION_REQUESTED,e):console.warn("[BoosterPanel] \u0411\u0443\u0441\u0442\u0435\u0440 "+e+" \u043d\u0435\u0434\u043e\u0441\u0442\u0443\u043f\u0435\u043d \u0434\u043b\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f")},t.prototype.onDestroy=function(){this.eventBus&&(this.eventBus.unsubscribe(s.UICommands.UPDATE_BOOSTERS,this.onUpdateBoosters,this),this.eventBus.unsubscribe(s.UICommands.SET_BOOSTER_ACTIVE,this.onSetActiveBooster,this)),this.bombButton&&(this.bombButton.node.off("click"),cc.Tween.stopAllByTarget(this.bombButton.node.parent)),this.swapButton&&(this.swapButton.node.off("click"),cc.Tween.stopAllByTarget(this.swapButton.node.parent))},r([l(cc.Button)],t.prototype,"bombButton",void 0),r([l(cc.Button)],t.prototype,"swapButton",void 0),r([l(cc.Label)],t.prototype,"bombCountLabel",void 0),r([l(cc.Label)],t.prototype,"swapCountLabel",void 0),r([u],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../../core/EventBus":"EventBus","../../features/boosters/BoostersTypes":"BoostersTypes"}],BoostersTypes:[function(e,t,o){"use strict";cc._RF.push(t,"90fbfPUdo1PK4BeI+SVR5Py","BoostersTypes"),Object.defineProperty(o,"__esModule",{value:!0}),o.BoosterType=void 0,function(e){e[e.BOMB=1]="BOMB",e[e.SWAP=2]="SWAP"}(o.BoosterType||(o.BoosterType={})),cc._RF.pop()},{}],ChainReactionService:[function(e,t,o){"use strict";cc._RF.push(t,"81ffdEa6ldGiaG59uh5QdRI","ChainReactionService");var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<o;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,n++)i[n]=r[s];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.ChainReactionService=void 0;var n=e("../../shared/utils/TileUtils"),r=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.processChainReaction=function(e,t,o){var r=i(t.removed),s=t.points,a=1,c=[o],u=t.affectedSuperTiles||[],l=new Set;for(l.add(o.row+","+o.col);u.length>0;){var p=i(u);u=[];for(var h=0,f=p;h<f.length;h++){var v=f[h],d=v.row+","+v.col;if(!l.has(d)){l.add(d);var g=e.getTile(v.row,v.col);if(g&&n.TileUtils.isSuperTile(g.type)){var y=g.activate(e);if(r.push.apply(r,y.removed),s+=y.points,c.push({row:v.row,col:v.col}),y.affectedSuperTiles)for(var m=0,T=y.affectedSuperTiles;m<T.length;m++){var S=T[m],w=S.row+","+S.col;l.has(w)||u.push(S)}}}}if(++a>10)break}return{allRemovedTiles:this.removeDuplicatePositions(r),totalPoints:s,chainLength:a-1,explosionCenters:c}},e.prototype.removeDuplicatePositions=function(e){for(var t=new Set,o=[],i=0,n=e;i<n.length;i++){var r=n[i],s=r.row+","+r.col;t.has(s)||(t.add(s),o.push(r))}return o},e}();o.ChainReactionService=r,cc._RF.pop()},{"../../shared/utils/TileUtils":"TileUtils"}],CoordinateService:[function(e,t,o){"use strict";cc._RF.push(t,"f0c5d3bKaFN1KI01Kir5KBm","CoordinateService"),Object.defineProperty(o,"__esModule",{value:!0}),o.CoordinateService=void 0;var i=function(){function e(){this.boardNode=null,this.tileSize=100,this.rows=8,this.cols=8}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setGameBoard=function(e,t,o,i){this.boardNode=e,this.tileSize=t,this.rows=o,this.cols=i},e.prototype.gameToWorldPosition=function(e,t){return this.calculatePositionFromBoard(e,t)},e.prototype.worldToGamePosition=function(e){if(!this.boardNode)return null;var t=this.boardNode.convertToNodeSpaceAR(e),o=-this.boardNode.width/2+this.tileSize/2,i=this.boardNode.height/2-this.tileSize/2,n=Math.floor((t.x-o)/this.tileSize+.5),r=Math.floor((i-t.y)/this.tileSize+.5);return r>=0&&r<this.rows&&n>=0&&n<this.cols?{row:r,col:n}:null},e.prototype.calculatePositionFromBoard=function(e,t){if(!this.boardNode)return this.calculateApproximatePosition(e,t);var o=-this.boardNode.width/2+this.tileSize/2,i=this.boardNode.height/2-this.tileSize/2,n=new cc.Vec2(o+t*this.tileSize,i-e*this.tileSize);return this.boardNode.convertToWorldSpaceAR(n)},e.prototype.calculateApproximatePosition=function(e,t){var o=this.cols*this.tileSize,i=this.rows*this.tileSize,n=0-o/2+t*this.tileSize+this.tileSize/2,r=0+i/2-e*this.tileSize-this.tileSize/2;return new cc.Vec2(n,r)},e.prototype.reset=function(){this.boardNode=null},e}();o.CoordinateService=i,cc._RF.pop()},{}],DevConsole:[function(e,t,o){"use strict";cc._RF.push(t,"6d298P1W4tEV6SryFDSJYPv","DevConsole"),Object.defineProperty(o,"__esModule",{value:!0}),o.DevConsole=void 0;var i=e("../../features/boosters/BoostersTypes"),n=e("../config/GameConfig"),r=e("../../ui/managers/ToastManager"),s=e("../../core/GameServiceContainer"),a=function(){function e(e,t){this.gameController=e,this.gameCoordinator=t,this.serviceContainer=s.GameServiceContainer.getGameInstance(),this.gameConfig=this.serviceContainer.getGameConfig()}return e.prototype.setupCommands=function(){this.registerCommands(),this.printAvailableCommands()},e.prototype.registerCommands=function(){var e=this;window.restartGame=function(){return e.restartGame()},window.testBigField=function(){return e.testBigField()},window.testSmallField=function(){return e.testSmallField()},window.addBombs=function(t){return e.addBombs(t)},window.addSwaps=function(t){return e.addSwaps(t)},window.testWin=function(){return e.testWin()},window.testLose=function(){return e.testLose()},window.addScore=function(t){return e.addScore(t)},window.setMoves=function(t){return e.setMoves(t)},window.addMoves=function(t){return e.addMoves(t)},window.showStats=function(){return e.showStats()},window.testToastSuccess=function(){return e.testToastSuccess()},window.testToastError=function(){return e.testToastError()},window.testToastInfo=function(){return e.testToastInfo()},window.testToastWarning=function(){return e.testToastWarning()},window.testToastQueue=function(){return e.testToastQueue()},window.clearToasts=function(){return e.clearToasts()},window.printBoard=function(t){return e.printBoard(t)},window.printBoardStats=function(){return e.printBoardStats()}},e.prototype.printAvailableCommands=function(){console.log("\ud83c\udfae \u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043a\u043e\u043d\u0441\u043e\u043b\u044c\u043d\u044b\u0435 \u043a\u043e\u043c\u0430\u043d\u0434\u044b:\n\ud83d\udccf \u0420\u0430\u0437\u043c\u0435\u0440 \u043f\u043e\u043b\u044f:\n  testSmallField() - \u043f\u043e\u043b\u0435 6x6\n  testBigField() - \u043f\u043e\u043b\u0435 10x10\n\ud83d\udca3 \u0411\u0443\u0441\u0442\u0435\u0440\u044b:\n  addBombs(count) - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c N \u0431\u043e\u043c\u0431\n  addSwaps(count) - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c N \u0441\u0432\u0430\u043f\u043e\u0432\n\ud83c\udfaf \u0418\u0433\u0440\u043e\u0432\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435:\n  testWin() - \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u0430\u044f \u043f\u043e\u0431\u0435\u0434\u0430\n  testLose() - \u043c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e\u0435 \u043f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435\n  addScore(points) - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u043e\u0447\u043a\u0438\n  setMoves(count) - \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0445\u043e\u0434\u044b\n  addMoves(count) - \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0445\u043e\u0434\u044b\n\ud83d\udd04 \u0423\u0442\u0438\u043b\u0438\u0442\u044b:\n  restartGame() - \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0443\u0441\u043a\n  showStats() - \u043f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0443\n\ud83c\udfa8 \u0412\u0438\u0437\u0443\u0430\u043b\u0438\u0437\u0430\u0446\u0438\u044f \u0434\u043e\u0441\u043a\u0438:\n  printBoard(title?) - \u043e\u0442\u0440\u0438\u0441\u043e\u0432\u0430\u0442\u044c \u0434\u043e\u0441\u043a\u0443 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438\n  printBoardStats() - \u0441\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0434\u043e\u0441\u043a\u0438\n\ud83c\udf5e Toast \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f:\n  testToastSuccess() - \u0442\u0435\u0441\u0442 \u0443\u0441\u043f\u0435\u0448\u043d\u043e\u0433\u043e \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f\n  testToastError() - \u0442\u0435\u0441\u0442 \u043e\u0448\u0438\u0431\u043a\u0438\n  testToastInfo() - \u0442\u0435\u0441\u0442 \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u0438\n  testToastWarning() - \u0442\u0435\u0441\u0442 \u043f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u044f\n  testToastQueue() - \u0442\u0435\u0441\u0442 \u043e\u0447\u0435\u0440\u0435\u0434\u0438 (5 toast'\u043e\u0432)\n  clearToasts() - \u043e\u0447\u0438\u0441\u0442\u0438\u0442\u044c \u0432\u0441\u0435 toast'\u044b")},e.prototype.testSmallField=function(){this.gameConfig.updateConfig(n.GameConfig.getTestConfig()),this.gameCoordinator.restartGame()},e.prototype.testBigField=function(){this.gameConfig.updateConfig({boardRows:10,boardCols:10,targetScore:2e3,totalMoves:50,maxShuffles:5}),this.gameCoordinator.restartGame()},e.prototype.addBombs=function(e){console.log("[DevConsole] \ud83d\udca3 \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c "+e+" \u0431\u043e\u043c\u0431"),this.serviceContainer.getBoosterManager().addBoosters(i.BoosterType.BOMB,e),this.gameController.updateUI()},e.prototype.addSwaps=function(e){console.log("[DevConsole] \ud83d\udd04 \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c "+e+" \u0441\u0432\u0430\u043f\u043e\u0432"),this.serviceContainer.getBoosterManager().addBoosters(i.BoosterType.SWAP,e),this.gameController.updateUI()},e.prototype.testWin=function(){console.log("[DevConsole] \ud83c\udfc6 \u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u0430\u044f \u043f\u043e\u0431\u0435\u0434\u0430!");var e=this.gameController.getGameModel().getScoreManager(),t=e.getTargetScore()-e.getScore()+100;e.addScore(t),this.gameController.updateUI(),this.gameController.checkAndHandleGameState()},e.prototype.testLose=function(){console.log("[DevConsole] \ud83d\udc80 \u041c\u0433\u043d\u043e\u0432\u0435\u043d\u043d\u043e\u0435 \u043f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435!");for(var e=this.gameController.getGameModel().getMovesManager();e.getMovesLeft()>0;)e.useMove();this.gameController.updateUI(),this.gameController.checkAndHandleGameState()},e.prototype.addScore=function(e){console.log("[DevConsole] \u2b50 \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c "+e+" \u043e\u0447\u043a\u043e\u0432"),this.gameController.getGameModel().getScoreManager().addScore(e),this.gameController.updateUI()},e.prototype.setMoves=function(e){console.log("[DevConsole] \ud83c\udfaf \u0423\u0441\u0442\u0430\u043d\u0430\u0432\u043b\u0438\u0432\u0430\u0435\u043c "+e+" \u0445\u043e\u0434\u043e\u0432");var t=this.gameController.getGameModel().getMovesManager(),o=t.getMovesLeft();t.addMoves(e-o),this.gameController.updateUI()},e.prototype.addMoves=function(e){console.log("[DevConsole] \u2795 \u0414\u043e\u0431\u0430\u0432\u043b\u044f\u0435\u043c "+e+" \u0445\u043e\u0434\u043e\u0432"),this.gameController.getGameModel().getMovesManager().addMoves(e),this.gameController.updateUI()},e.prototype.restartGame=function(){this.gameCoordinator.restartGame()},e.prototype.showStats=function(){var e=this.gameController.getGameModel(),t=e.getScoreManager(),o=e.getMovesManager(),n=e.getGameBoard(),r=this.serviceContainer.getBoosterManager(),s="\ud83d\udcca === \u0421\u0422\u0410\u0422\u0418\u0421\u0422\u0418\u041a\u0410 \u0418\u0413\u0420\u042b ===\n";s+="\ud83c\udfaf \u0421\u0447\u0435\u0442: "+t.getScore()+"/"+t.getTargetScore()+"\n",s+="\ud83c\udfae \u0425\u043e\u0434\u044b: "+o.getMovesLeft()+"/"+o.getTotalMoves()+"\n",s+="\ud83c\udfb2 \u041f\u0435\u0440\u0435\u043c\u0435\u0448\u0438\u0432\u0430\u043d\u0438\u044f: "+e.getShufflesLeft()+"/3\n",s+="\ud83d\udccf \u0420\u0430\u0437\u043c\u0435\u0440 \u043f\u043e\u043b\u044f: "+n.rows+"x"+n.cols+"\n",s+="\ud83d\udca3 \u0411\u043e\u043c\u0431\u044b: "+r.getBoosterCount(i.BoosterType.BOMB)+"\n",s+="\ud83d\udd04 \u0421\u0432\u0430\u043f\u044b: "+r.getBoosterCount(i.BoosterType.SWAP)+"\n",s+="\ud83c\udfae \u0421\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435: "+(0===e.getGameState()?"Playing":1===e.getGameState()?"WON":"LOST")+"\n",s+="===========================",console.log(s)},e.prototype.testToastSuccess=function(){r.ToastManager.getInstance().showSuccess("\ud83c\udf89 \u041e\u0442\u043b\u0438\u0447\u043d\u0430\u044f \u0440\u0430\u0431\u043e\u0442\u0430! \u0412\u044b \u043d\u0430\u0431\u0440\u0430\u043b\u0438 \u043c\u043d\u043e\u0433\u043e \u043e\u0447\u043a\u043e\u0432!")},e.prototype.testToastError=function(){r.ToastManager.getInstance().showError("\u274c \u041e\u0448\u0438\u0431\u043a\u0430! \u041d\u0435\u0434\u043e\u0441\u0442\u0430\u0442\u043e\u0447\u043d\u043e \u0445\u043e\u0434\u043e\u0432 \u0434\u043b\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f \u0443\u0440\u043e\u0432\u043d\u044f")},e.prototype.testToastInfo=function(){r.ToastManager.getInstance().showInfo("\u2139\ufe0f \u0421\u043e\u0432\u0435\u0442: \u041f\u043e\u043f\u0440\u043e\u0431\u0443\u0439\u0442\u0435 \u0441\u043e\u0437\u0434\u0430\u0442\u044c \u0441\u0443\u043f\u0435\u0440\u0442\u0430\u0439\u043b\u044b \u0434\u043b\u044f \u0431\u043e\u043b\u044c\u0448\u0438\u0445 \u043e\u0447\u043a\u043e\u0432")},e.prototype.testToastWarning=function(){r.ToastManager.getInstance().showWarning("\u26a0\ufe0f \u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435! \u0423 \u0432\u0430\u0441 \u043e\u0441\u0442\u0430\u043b\u043e\u0441\u044c \u043c\u0430\u043b\u043e \u0445\u043e\u0434\u043e\u0432")},e.prototype.testToastQueue=function(){var e=r.ToastManager.getInstance();e.showSuccess("Toast 1: \u0423\u0441\u043f\u0435\u0445!"),e.showError("Toast 2: \u041e\u0448\u0438\u0431\u043a\u0430!"),e.showInfo("Toast 3: \u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f!"),e.showWarning("Toast 4: \u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435!"),e.showSuccess("Toast 5: \u0415\u0449\u0435 \u043e\u0434\u0438\u043d \u0443\u0441\u043f\u0435\u0445!")},e.prototype.clearToasts=function(){r.ToastManager.getInstance().clear(),console.log("\ud83e\uddf9 \u0412\u0441\u0435 toast \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f \u043e\u0447\u0438\u0449\u0435\u043d\u044b")},e.prototype.printBoard=function(e){console.log("[DevConsole] \ud83c\udfa8 \u041e\u0442\u0440\u0438\u0441\u043e\u0432\u043a\u0430 \u0434\u043e\u0441\u043a\u0438 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"),this.gameController.getGameModel().getGameBoard().printBoard(e)},e.prototype.printBoardStats=function(){console.log("[DevConsole] \ud83d\udcca \u0421\u0442\u0430\u0442\u0438\u0441\u0442\u0438\u043a\u0430 \u0434\u043e\u0441\u043a\u0438"),this.gameController.getGameModel().getGameBoard().printBoardStats()},e.prototype.destroy=function(){delete window.restartGame,delete window.testBigField,delete window.testSmallField,delete window.addBombs,delete window.addSwaps,delete window.testWin,delete window.testLose,delete window.addScore,delete window.setMoves,delete window.addMoves,delete window.showStats,delete window.testToastSuccess,delete window.testToastError,delete window.testToastInfo,delete window.testToastWarning,delete window.testToastQueue,delete window.clearToasts,delete window.printBoard,delete window.printBoardStats},e}();o.DevConsole=a,cc._RF.pop()},{"../../core/GameServiceContainer":"GameServiceContainer","../../features/boosters/BoostersTypes":"BoostersTypes","../../ui/managers/ToastManager":"ToastManager","../config/GameConfig":"GameConfig"}],EventBus:[function(e,t,o){"use strict";cc._RF.push(t,"18c4cQrj85GRJKcfMX/F/xp","EventBus");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<o;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,n++)i[n]=r[s];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.UICommands=o.GameEvents=o.EventBus=void 0;var s=function(e){function t(){return e.call(this)||this}return n(t,e),t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.subscribe=function(e,t,o){this.on(e,t,o)},t.prototype.unsubscribe=function(e,t,o){this.off(e,t,o)},t.prototype.publish=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.emit.apply(this,r([e],t))},t.prototype.clear=function(){this.targetOff(this)},t}(cc.EventTarget);o.EventBus=s,o.GameEvents={TILE_CLICKED:"game:tile-clicked",BOOSTER_ACTIVATION_REQUESTED:"game:booster-activation-requested",BOOSTER_DEACTIVATION_REQUESTED:"game:booster-deactivation-requested",SHUFFLE_REQUESTED:"game:shuffle-requested",GAME_RESTART_REQUESTED:"game:restart-requested",NEED_SHUFFLE:"game:need-shuffle",MOVE_COMPLETED:"game:move-completed",HINT_REQUEST:"game:hint-request",ANIMATION_COMPLETED:"game:animation-completed"},o.UICommands={BOARD_INIT:"board:init",UPDATE_SCORE:"ui:update-score",UPDATE_MOVES:"ui:update-moves",UPDATE_SHUFFLES:"ui:update-shuffles",UPDATE_BOOSTERS:"ui:update-boosters",SET_BOOSTER_ACTIVE:"ui:set-booster-active",SHUFFLE_REQUESTED:"ui:shuffle-requested",SHOW_GAME_OVER:"ui:show-game-over",HIDE_GAME_OVER:"ui:hide-game-over",INITIALIZE_GAME_OVER:"ui:initialize-game-over",HINT_ANIMATION_START:"ui:hint-animation-start",HINT_ANIMATION_STOP:"ui:hint-animation-stop",TOAST_SHOW:"ui:toast-show",TOAST_CLEAR_ALL:"ui:toast-clear-all"},cc._RF.pop()},{}],GameBoard:[function(e,t,o){"use strict";cc._RF.push(t,"25eb0laGjlAEJ00dYTPRe5r","GameBoard");var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameBoard=void 0;var n=e("../../features/tiles/TileTypes"),r=e("./SuperTileRules"),s=e("../../shared/utils/TileUtils"),a=e("../../features/tiles/TileFactory"),c=cc._decorator.ccclass,u=function(){function e(e,t,o){this._rows=e,this._cols=t,this._minimumGroupSize=o,this.tiles=[],this.tileFactory=a.TileFactory.getInstance(),this.superTileRules=new r.SuperTileRules,this.initBoard(),this.generateBoardWithMoves()}return Object.defineProperty(e.prototype,"rows",{get:function(){return this._rows},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cols",{get:function(){return this._cols},enumerable:!1,configurable:!0}),e.prototype.initBoard=function(){for(var e=0;e<this._rows;e++){this.tiles[e]=[];for(var t=0;t<this._cols;t++)this.tiles[e][t]=null}},e.prototype.fillBoard=function(){for(var e=0;e<this._rows;e++)for(var t=0;t<this._cols;t++)null===this.tiles[e][t]&&(this.tiles[e][t]=this.createRandomTile(e,t))},e.prototype.createRandomTile=function(e,t){return this.tileFactory.createRandomRegularTile({row:e,col:t})},e.prototype.hasMatchableGroups=function(){for(var e=0;e<this._rows;e++)for(var t=0;t<this._cols;t++){var o=this.tiles[e][t];if(o&&o.canActivate(this)&&o.getTargets(this).length>=this._minimumGroupSize)return!0}return!1},e.prototype.createSuperTile=function(e,t,o){var i=this.superTileRules.determineSuperTileType(o);return i?(this.tiles[e][t]=this.tileFactory.createTile(i,{row:e,col:t}),i):null},e.prototype.removeGroup=function(e){for(var t=0,o=0,i=e;o<i.length;o++){var n=i[o];this.tiles[n.row]&&this.tiles[n.row][n.col]&&(this.tiles[n.row][n.col]=null,t++)}return t},e.prototype.applyGravity=function(){for(var e=[],t=0;t<this.cols;t++){for(var o=[],i=[],n=this.rows-1;n>=0;n--)null!==this.tiles[n][t]&&(o.push(this.tiles[n][t]),i.push(n),this.tiles[n][t]=null);for(var r=0;r<o.length;r++){var s=this.rows-1-r,a=i[r],c=o[r];c.setPosition({row:s,col:t}),this.tiles[s][t]=c,a!==s&&e.push({from:{row:a,col:t},to:{row:s,col:t}})}}return e},e.prototype.fillEmptyCells=function(){for(var e=[],t=0;t<this._cols;t++)for(var o=this._rows-1;o>=0;o--)if(!this.tiles[o][t]){var i=this.createRandomTile(o,t);this.tiles[o][t]=i,e.push({row:o,col:t,type:i.type})}return e},e.prototype.shuffleBoard=function(){for(var e=0;e<10;){e++;for(var t=[],o=0;o<this._rows;o++)for(var i=0;i<this._cols;i++)this.tiles[o][i]&&s.TileUtils.isSuperTile(this.tiles[o][i].type)&&t.push({row:o,col:i,type:this.tiles[o][i].type});var n=[];for(o=0;o<this._rows;o++)for(i=0;i<this._cols;i++)if(this.tiles[o][i]){var r=this.tiles[o][i].type;s.TileUtils.isRegularTile(r)&&n.push(r)}for(var a=this._rows*this._cols-t.length;n.length<a;){var c=this.getRandomTileType();n.push(c)}for(this.shuffleArray(n),o=0;o<this._rows;o++)for(i=0;i<this._cols;i++)this.tiles[o][i]=null;var u=0,l=function(e){for(var o=function(o){if(!t.find(function(t){return t.row===e&&t.col===o})&&u<n.length){var i=n[u++];p.tiles[e][o]=p.tileFactory.createTile(i,{row:e,col:o})}},i=0;i<p._cols;i++)o(i)},p=this;for(o=0;o<this._rows;o++)l(o);for(var h=0,f=t;h<f.length;h++){var v=f[h];this.tiles[v.row][v.col]=this.tileFactory.createTile(v.type,{row:v.row,col:v.col})}if(this.hasMatchableGroups())return}},e.prototype.shuffleArray=function(e){for(var t,o=e.length-1;o>0;o--){var i=Math.floor(Math.random()*(o+1));t=[e[i],e[o]],e[o]=t[0],e[i]=t[1]}},e.prototype.getRandomTileType=function(){var e=s.TileUtils.getRegularTileTypes();return e[Math.floor(Math.random()*e.length)]},e.prototype.getTile=function(e,t){return this.isValidPosition(e,t)?this.tiles[e][t]:null},e.prototype.setTile=function(e,t,o){this.isValidPosition(e,t)&&(this.tiles[e][t]=o)},e.prototype.isValidPosition=function(e,t){return e>=0&&e<this.rows&&t>=0&&t<this.cols},e.prototype.generateBoardWithMoves=function(){for(var e=0;e<50;){for(var t=0;t<this._rows;t++)for(var o=0;o<this._cols;o++)this.tiles[t][o]=null;if(this.fillBoard(),this.hasMatchableGroups())return;e++}this.forceCreateGroup()},e.prototype.forceCreateGroup=function(){var e=Math.floor(this._rows/2),t=Math.floor(this._cols/2),o=s.TileUtils.getRegularTileTypes(),i=o[Math.floor(Math.random()*o.length)],n=[];if(4===this._minimumGroupSize)n.push({row:e,col:t},{row:e,col:t+1},{row:e+1,col:t},{row:e+1,col:t+1});else{n.push({row:e,col:t});for(var r=[{row:-1,col:0},{row:1,col:0},{row:0,col:-1},{row:0,col:1}],a=1;a<this._minimumGroupSize&&n.length<this._minimumGroupSize;a++){var c=r[(a-1)%r.length],u=e+c.row*Math.ceil(a/r.length),l=t+c.col*Math.ceil(a/r.length);this.isValidPosition(u,l)&&n.push({row:u,col:l})}}for(var p=0,h=n;p<h.length;p++){var f=h[p];this.isValidPosition(f.row,f.col)&&(this.tiles[f.row][f.col]=this.tileFactory.createTile(i,{row:f.row,col:f.col}))}},e.prototype.printBoard=function(e){var t="";t+=e?"\n=== "+e+" ===\n":"\n=== Game Board ===\n";for(var o="   ",i=0;i<this._cols;i++)o+=" "+i.toString().padStart(2)+" ";t+=o+"\n";var n="   ";for(i=0;i<this._cols;i++)n+="----";t+=n+"\n";for(var r=0;r<this._rows;r++){var s=r.toString().padStart(2)+"|";for(i=0;i<this._cols;i++){var a=this.tiles[r][i];s+=" "+this.getTileSymbol(a)+" "}t+=s+"\n"}console.log(t)},e.prototype.getTileSymbol=function(e){if(!e)return" . ";switch(e.type){case n.TileType.RED:return" R ";case n.TileType.BLUE:return" B ";case n.TileType.GREEN:return" G ";case n.TileType.YELLOW:return" Y ";case n.TileType.PURPLE:return" P ";case n.TileType.SUPER_ROW:return"[R]";case n.TileType.SUPER_COLUMN:return"[C]";case n.TileType.SUPER_BOMB:return"[B]";case n.TileType.SUPER_ALL:return"[A]";default:return" ? "}},e.prototype.printBoardStats=function(){for(var e=this,t="\n=== Board Statistics ===\n",o=new Map,i=0,n=0;n<this._rows;n++)for(var r=0;r<this._cols;r++){var s=this.tiles[n][r];s?o.set(s.type,(o.get(s.type)||0)+1):i++}t+="Board size: "+this._rows+"x"+this._cols+" ("+this._rows*this._cols+" cells)\n",t+="Empty cells: "+i+"\n",t+="Filled cells: "+(this._rows*this._cols-i)+"\n",o.size>0&&(t+="\nTile distribution:\n",o.forEach(function(o,n){var r=e.getTileSymbol({type:n}).trim(),s=(o/(e._rows*e._cols-i)*100).toFixed(1);t+="  "+r+" "+n+": "+o+" ("+s+"%)\n"})),t+="Has matchable groups: "+this.hasMatchableGroups()+"\n",console.log(t)},i([c],e)}();o.GameBoard=u,cc._RF.pop()},{"../../features/tiles/TileFactory":"TileFactory","../../features/tiles/TileTypes":"TileTypes","../../shared/utils/TileUtils":"TileUtils","./SuperTileRules":"SuperTileRules"}],GameConfig:[function(e,t,o){"use strict";cc._RF.push(t,"c44eeKXClpC3ZaCLp2O8V39","GameConfig");var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.GameConfig=void 0;var n=function(){function e(e){this.config={boardRows:8,boardCols:8,targetScore:1e4,totalMoves:30,minimumGroupSize:2,maxShuffles:3},e&&(this.config=i(i({},this.config),e))}return e.prototype.getCurrentLevelConfig=function(){return i({},this.config)},e.prototype.onLevelCompleted=function(e,t){console.log("[LocalConfigProvider] \u0423\u0440\u043e\u0432\u0435\u043d\u044c \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d: "+e+" \u043e\u0447\u043a\u043e\u0432 \u0437\u0430 "+t+" \u0445\u043e\u0434\u043e\u0432")},e.prototype.onLevelFailed=function(e){console.log("[LocalConfigProvider] \u0423\u0440\u043e\u0432\u0435\u043d\u044c \u043f\u0440\u043e\u0432\u0430\u043b\u0435\u043d \u0441 \u0440\u0435\u0437\u0443\u043b\u044c\u0442\u0430\u0442\u043e\u043c: "+e+" \u043e\u0447\u043a\u043e\u0432")},e.prototype.updateConfig=function(e){this.config=i(i({},this.config),e)},e}(),r=function(){function e(){this.configProvider=new n}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.getCurrentLevel=function(){return this.configProvider.getCurrentLevelConfig()},e.prototype.onLevelCompleted=function(e,t){this.configProvider.onLevelCompleted(e,t)},e.prototype.onLevelFailed=function(e){this.configProvider.onLevelFailed(e)},e.prototype.updateConfig=function(e){this.configProvider instanceof n&&this.configProvider.updateConfig(e)},e.prototype.setConfigProvider=function(e){this.configProvider=e},e.createLocalProvider=function(e){return new n(e)},e.getTestConfig=function(){return{boardRows:6,boardCols:6,targetScore:300,totalMoves:15,minimumGroupSize:2,maxShuffles:1}},e.getBigFieldConfig=function(){return{boardRows:10,boardCols:10,targetScore:2e3,totalMoves:50,minimumGroupSize:2,maxShuffles:5}},e}();o.GameConfig=r,cc._RF.pop()},{}],GameController:[function(e,t,o){"use strict";cc._RF.push(t,"dfe48eRPNVKwKkNfgPTuYn3","GameController");var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var n=e("./GameServiceContainer"),r=e("../game/models/GameModel"),s=e("../shared/utils/TileUtils"),a=e("../game/services/ChainReactionService"),c=cc._decorator.ccclass,u=function(){function e(){var e=this;this.pendingGameStateCheck=!1;var t=n.GameServiceContainer.getGameInstance();this.animationService=t.getAnimationService(),this.UICommandService=t.getUICommandService(),this.gameConfig=t.getGameConfig(),this.boosterManager=t.getBoosterManager(),this.hintService=t.getHintService(),setTimeout(function(){e.initializeGame()},0)}return e.prototype.initializeGame=function(){this.initializeBoard(),this.updateUI()},e.prototype.initializeBoard=function(){var e=this,t=this.gameConfig.getCurrentLevel();this.gameModel=new r.GameModel(t.boardRows,t.boardCols,t.targetScore,t.totalMoves),this.UICommandService.initializeBoard(t.boardRows,t.boardCols,function(t,o){var i=e.gameModel.getGameBoard().getTile(t,o);return i?i.type:null})},e.prototype.completeMoveSequence=function(e){e&&(this.UICommandService.reportMoveResult(e),e.points>0&&e.explosionCenter&&this.UICommandService.showScorePopup(e.points,e.explosionCenter,e)),this.updateUI(),this.pendingGameStateCheck=!0,this.animationService.isProcessing||this.checkPendingGameState()},e.prototype.updateUI=function(){if(this.UICommandService&&this.gameModel){var e=this.gameModel.getScoreManager(),t=this.gameModel.getMovesManager();this.UICommandService.updateScore(e.getScore(),e.getTargetScore()),this.UICommandService.updateMoves(t.getMovesLeft()),this.UICommandService.updateShuffles(this.gameModel.getShufflesLeft()),this.UICommandService.updateBoosters(this.boosterManager.getAllBoosterCounts())}},e.prototype.checkAndHandleGameState=function(){var e=this;if(this.gameModel){this.gameModel.checkGameState();var t=this.gameModel.getGameState();0!==t?setTimeout(function(){var o=e.gameModel.getScoreManager(),i=1===t?"\u041f\u043e\u0431\u0435\u0434\u0430!":"\u041f\u043e\u0440\u0430\u0436\u0435\u043d\u0438\u0435!";e.UICommandService.showGameOver(i,o.getScore(),o.getTargetScore())},1e3):this.gameModel.checkNeedShuffle()}},e.prototype.handleNeedShuffle=function(){var e=this,t=this.gameModel;if(t.getShufflesLeft()>0){this.UICommandService.showMessage("\u041d\u0435\u0442 \u0434\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0445 \u0445\u043e\u0434\u043e\u0432!\n\u041f\u0435\u0440\u0435\u043c\u0435\u0448\u0438\u0432\u0430\u0435\u043c \u043f\u043e\u043b\u0435...",2.5);var o=function(){t.shuffleBoard();var o=t.getGameBoard();e.UICommandService.reportShuffleEvent({reason:"auto",boardData:{rows:o.rows,cols:o.cols,getTileType:function(e,t){var i=o.getTile(e,t);return i?i.type:null}}}),e.updateUI()};this.waitForAnimationsToComplete(function(){setTimeout(o,1e3)},o)}else this.waitForAnimationsToComplete(function(){e.UICommandService.showGameOver("\u041f\u041e\u0420\u0410\u0416\u0415\u041d\u0418\u0415!",t.getScoreManager().getScore(),t.getScoreManager().getTargetScore())})},e.prototype.waitForAnimationsToComplete=function(e,t){var o=this;if(this.animationService.isProcessing){var i=function(){o.animationService.isProcessing?setTimeout(i,100):e()};i()}else t?t():e()},e.prototype.handleHintRequest=function(){if(this.gameModel&&0===this.gameModel.getGameState()){var e=this.findAvailableHint();e&&e.length>0&&this.hintService.showHint(e)}},e.prototype.findAvailableHint=function(){for(var e=this.gameModel.getGameBoard(),t=0;t<e.rows;t++)for(var o=0;o<e.cols;o++){var i=e.getTile(t,o);if(i&&i.canActivate(e)){var n=i.getTargets(e);return s.TileUtils.isSuperTile(i.type)?[{row:t,col:o}]:n}}return[]},e.prototype.handleTileClick=function(e,t){this.animationService.isProcessing?console.log("[GameController] \u0410\u043d\u0438\u043c\u0430\u0446\u0438\u044f \u0432 \u043f\u0440\u043e\u0446\u0435\u0441\u0441\u0435, \u043a\u043b\u0438\u043a \u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0443\u0435\u0442\u0441\u044f"):null!==this.boosterManager.getActiveBoosterType()?this.processBoosterClick(e,t):this.processRegularClick(e,t)},e.prototype.processRegularClick=function(e,t){var o=this.gameModel.handleTileClick(e,t);this.completeMoveSequence(o)},e.prototype.processBoosterClick=function(e,t){var o=this.boosterManager.handleClick(this.gameModel.getGameBoard(),{row:e,col:t});if(o.success){var i=this.applyBoosterChanges(o);this.boosterManager.deactivateBooster(),this.UICommandService.setBoosterActive(null),this.completeMoveSequence(i)}},e.prototype.applyBoosterChanges=function(e){var t,o={removed:[],points:e.points||0,movesLeft:this.gameModel.getMovesManager().getMovesLeft(),gameState:this.gameModel.getGameState(),explosionCenter:void 0,movedTiles:[],newTiles:[],swappedTile:void 0,clickedGroup:void 0,chainLength:void 0,explosionCenters:void 0};if(e.points&&this.gameModel.getScoreManager().addScore(e.points),(null===(t=e.removed)||void 0===t?void 0:t.length)>0){for(var i=this.gameModel.getGameBoard(),n=a.ChainReactionService.getInstance(),r=e.removed,c=e.points||0,u=1,l=[e.explosionCenter||e.removed[0]],p=[],h=0,f=e.removed;h<f.length;h++){var v=f[h],d=i.getTile(v.row,v.col);d&&s.TileUtils.isSuperTile(d.type)&&p.push({row:v.row,col:v.col,type:d.type})}if(p.length>0){var g={removed:e.removed,points:e.points||0,affectedSuperTiles:p},y=n.processChainReaction(i,g,e.explosionCenter||e.removed[0]);r=y.allRemovedTiles,c=y.totalPoints,u=y.chainLength,l=y.explosionCenters,this.gameModel.getScoreManager().addScore(c-(e.points||0))}i.removeGroup(r);var m=i.applyGravity(),T=i.fillEmptyCells();o.removed=r,o.points=c,o.movedTiles=m,o.newTiles=T,o.explosionCenter=e.explosionCenter||e.removed[0],o.chainLength=u>1?u:void 0,o.explosionCenters=u>1?l:void 0}return e.swappedTile&&(o.swappedTile=e.swappedTile,o.explosionCenter=e.swappedTile.pos2),o},e.prototype.handleBoosterActivation=function(e){this.boosterManager.activateBooster(e)&&this.UICommandService.setBoosterActive(e)},e.prototype.checkPendingGameState=function(){this.pendingGameStateCheck&&(this.pendingGameStateCheck=!1,this.checkAndHandleGameState())},e.prototype.resetGame=function(){this.boosterManager.reset();var e=this.gameConfig.getCurrentLevel();this.gameModel.resetGame(e.boardRows,e.boardCols,e.targetScore,e.totalMoves),this.initializeBoard(),this.updateUI()},e.prototype.getGameModel=function(){return this.gameModel},e.prototype.activateBooster=function(e){this.handleBoosterActivation(e)},e.prototype.deactivateBooster=function(){this.boosterManager.deactivateBooster(),this.UICommandService.setBoosterActive(null)},e.prototype.requestShuffle=function(){if(this.gameModel.getShufflesLeft()>0){this.UICommandService.showMessage("\u041f\u0435\u0440\u0435\u043c\u0435\u0448\u0438\u0432\u0430\u0435\u043c \u043f\u043e\u043b\u0435..."),this.gameModel.shuffleBoard();var e=this.gameModel.getGameBoard();this.UICommandService.reportShuffleEvent({reason:"manual",boardData:{rows:e.rows,cols:e.cols,getTileType:function(t,o){var i=e.getTile(t,o);return i?i.type:null}}}),this.updateUI()}},i([c],e)}();o.default=u,cc._RF.pop()},{"../game/models/GameModel":"GameModel","../game/services/ChainReactionService":"ChainReactionService","../shared/utils/TileUtils":"TileUtils","./GameServiceContainer":"GameServiceContainer"}],GameModel:[function(e,t,o){"use strict";cc._RF.push(t,"243386SwE9IVYHi/FOVTx0J","GameModel");var i=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0}),o.GameModel=void 0;var n=e("../GameTypes"),r=e("./GameBoard"),s=e("../managers/ScoreManager"),a=e("../managers/MovesManager"),c=e("./GameState"),u=e("../../shared/config/GameConfig"),l=e("../../shared/utils/TileUtils"),p=e("../../core/EventBus"),h=e("../services/ChainReactionService"),f=cc._decorator.ccclass,v=function(){function e(e,t,o,i){this.shufflesLeft=3,this.isShuffling=!1,this.eventBus=p.EventBus.getInstance(),this.gameConfig=u.GameConfig.getInstance(),this.gameBoard=new r.GameBoard(e,t,this.gameConfig.getCurrentLevel().minimumGroupSize);var l=new c.GameState(o,i);this.scoreManager=new s.ScoreManager(l),this.movesManager=new a.MovesManager(l),this.chainReactionService=h.ChainReactionService.getInstance(),this.gameState=n.GameState.PLAYING}return e.prototype.handleTileClick=function(e,t){var o,i={row:e,col:t};if(this.gameState!==n.GameState.PLAYING)return{removed:[],points:0,movesLeft:this.movesManager.getMovesLeft(),gameState:this.gameState,explosionCenter:{row:e,col:t},clickedGroup:[i]};var r=this.gameBoard.getTile(e,t);if(!r)return{removed:[],points:0,movesLeft:this.movesManager.getMovesLeft(),gameState:this.gameState,explosionCenter:{row:e,col:t},clickedGroup:[i]};var s=r.getTargets(this.gameBoard);if(!r.canActivate(this.gameBoard))return{removed:[],points:0,movesLeft:this.movesManager.getMovesLeft(),gameState:this.gameState,explosionCenter:{row:e,col:t},clickedGroup:s};var a,c,u,p=r.activate(this.gameBoard),h=1,f=[{row:e,col:t}];if(l.TileUtils.isRegularTile(r.type)&&p.removed.length>=5){var v=this.gameBoard.createSuperTile(e,t,p.removed);if(v){a={row:e,col:t,type:v};var d=p.removed.filter(function(o){return!(o.row===e&&o.col===t)});this.gameBoard.removeGroup(d)}else this.gameBoard.removeGroup(p.removed);c=p.removed,u=this.scoreManager.addScore(p.points)}else if(l.TileUtils.isSuperTile(r.type)&&(null===(o=p.affectedSuperTiles)||void 0===o?void 0:o.length)>0){var g=this.chainReactionService.processChainReaction(this.gameBoard,p,{row:e,col:t});this.gameBoard.removeGroup(g.allRemovedTiles),c=g.allRemovedTiles,u=this.scoreManager.addScore(g.totalPoints),h=g.chainLength,f=g.explosionCenters}else this.gameBoard.removeGroup(p.removed),c=p.removed,u=this.scoreManager.addScore(p.points);var y=this.gameBoard.applyGravity(),m=this.gameBoard.fillEmptyCells();return this.movesManager.useMove(),this.updateGameState(),{removed:c,points:u,movesLeft:this.movesManager.getMovesLeft(),gameState:this.gameState,superTile:a,movedTiles:y,newTiles:m,explosionCenter:{row:e,col:t},clickedGroup:s,chainLength:h>1?h:void 0,explosionCenters:h>1?f:void 0}},e.prototype.updateGameState=function(){var e=this.scoreManager.getScore(),t=this.scoreManager.getTargetScore(),o=this.movesManager.getMovesLeft();e>=t?this.gameState=n.GameState.WON:o<=0&&(this.gameState=n.GameState.LOST)},e.prototype.shuffleBoard=function(){this.shufflesLeft>0&&(this.gameBoard.shuffleBoard(),this.shufflesLeft--,this.isShuffling=!1)},e.prototype.resetGame=function(e,t,o,i){this.gameBoard=new r.GameBoard(e,t,this.gameConfig.getCurrentLevel().minimumGroupSize);var u=new c.GameState(o,i);this.scoreManager=new s.ScoreManager(u),this.movesManager=new a.MovesManager(u),this.gameState=n.GameState.PLAYING,this.shufflesLeft=3,this.isShuffling=!1},e.prototype.getGameBoard=function(){return this.gameBoard},e.prototype.getScoreManager=function(){return this.scoreManager},e.prototype.getMovesManager=function(){return this.movesManager},e.prototype.getGameState=function(){return this.gameState},e.prototype.getShufflesLeft=function(){return this.shufflesLeft},e.prototype.checkGameState=function(){this.updateGameState()},e.prototype.checkNeedShuffle=function(){this.gameState!==n.GameState.PLAYING||this.isShuffling||this.gameBoard.hasMatchableGroups()||(this.isShuffling=!0,this.eventBus.publish(p.GameEvents.NEED_SHUFFLE))},i([f],e)}();o.GameModel=v,cc._RF.pop()},{"../../core/EventBus":"EventBus","../../shared/config/GameConfig":"GameConfig","../../shared/utils/TileUtils":"TileUtils","../GameTypes":"GameTypes","../managers/MovesManager":"MovesManager","../managers/ScoreManager":"ScoreManager","../services/ChainReactionService":"ChainReactionService","./GameBoard":"GameBoard","./GameState":"GameState"}],GameOverView:[function(e,t,o){"use strict";cc._RF.push(t,"594e0JvupZPwo6O7rAGer99","GameOverView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../core/EventBus"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gameOverPanel=null,t.gameOverMessage=null,t.finalScoreLabel=null,t.restartButton=null,t}return n(t,e),t.prototype.onLoad=function(){this.eventBus=s.EventBus.getInstance(),this.setupEventListeners(),this.setupButtonListeners(),this.gameOverPanel.active=!1},t.prototype.setupEventListeners=function(){this.eventBus.subscribe(s.UICommands.SHOW_GAME_OVER,this.onShowGameOver,this),this.eventBus.subscribe(s.UICommands.HIDE_GAME_OVER,this.onHideGameOver,this),this.eventBus.subscribe(s.UICommands.INITIALIZE_GAME_OVER,this.onInitializeGameOver,this)},t.prototype.setupButtonListeners=function(){this.restartButton&&this.restartButton.node.on("click",this.onRestartButtonClicked,this)},t.prototype.onShowGameOver=function(e){this.gameOverPanel&&(this.gameOverPanel.active=!0),this.gameOverMessage&&(this.gameOverMessage.string=e.message),this.finalScoreLabel&&void 0!==e.finalScore&&(this.finalScoreLabel.string=e.finalScore+(e.targetScore?"/"+e.targetScore:""))},t.prototype.onHideGameOver=function(){this.gameOverPanel&&(this.gameOverPanel.active=!1)},t.prototype.onInitializeGameOver=function(e){this.gameOverPanel&&(this.gameOverPanel.active=e)},t.prototype.onRestartButtonClicked=function(){this.eventBus.publish(s.GameEvents.GAME_RESTART_REQUESTED)},t.prototype.onDestroy=function(){this.eventBus&&(this.eventBus.unsubscribe(s.UICommands.SHOW_GAME_OVER,this.onShowGameOver,this),this.eventBus.unsubscribe(s.UICommands.HIDE_GAME_OVER,this.onHideGameOver,this),this.eventBus.unsubscribe(s.UICommands.INITIALIZE_GAME_OVER,this.onInitializeGameOver,this)),this.restartButton&&this.restartButton.node.off("click",this.onRestartButtonClicked,this)},r([u(cc.Node)],t.prototype,"gameOverPanel",void 0),r([u(cc.Label)],t.prototype,"gameOverMessage",void 0),r([u(cc.Label)],t.prototype,"finalScoreLabel",void 0),r([u(cc.Button)],t.prototype,"restartButton",void 0),r([c],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../../core/EventBus":"EventBus"}],GameServiceContainer:[function(e,t,o){"use strict";cc._RF.push(t,"e2dfeF2NFNI37nBRzdMaPRs","GameServiceContainer");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.GameServiceContainer=void 0;var r=e("./ServiceContainer"),s=e("../features/tiles/TileFactory"),a=e("./EventBus"),c=e("../game/services/AnimationService"),u=e("../game/managers/BoosterManager"),l=e("../shared/config/GameConfig"),p=e("../game/managers/UICommandService"),h=e("../game/services/CoordinateService"),f=e("../game/services/SwapVisualService"),v=e("../game/services/ChainReactionService"),d=e("../game/services/HintService"),g=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.getGameInstance=function(){return t.gameInstance||(t.gameInstance=new t,t.gameInstance.configureServices()),t.gameInstance},t.prototype.configureServices=function(){this.registerSingleton("TileFactory",function(){return s.TileFactory.getInstance()}),this.registerSingleton("GameConfig",function(){return l.GameConfig.getInstance()}),this.registerSingleton("EventBus",function(){return a.EventBus.getInstance()}),this.registerSingleton("AnimationService",function(){return new c.AnimationService}),this.registerSingleton("UICommandService",function(){return new p.UICommandService}),this.registerSingleton("CoordinateService",function(){return h.CoordinateService.getInstance()}),this.registerSingleton("SwapVisualService",function(){return f.SwapVisualService.getInstance()}),this.registerSingleton("ChainReactionService",function(){return v.ChainReactionService.getInstance()}),this.registerSingleton("HintService",function(){return new d.HintService}),this.register("BoosterManager",function(){return new u.BoosterManager})},t.prototype.getTileFactory=function(){return this.resolve("TileFactory")},t.prototype.getEventBus=function(){return this.resolve("EventBus")},t.prototype.getAnimationService=function(){return this.resolve("AnimationService")},t.prototype.getBoosterManager=function(){return this.resolve("BoosterManager")},t.prototype.getGameConfig=function(){return this.resolve("GameConfig")},t.prototype.getUICommandService=function(){return this.resolve("UICommandService")},t.prototype.getCoordinateService=function(){return this.resolve("CoordinateService")},t.prototype.getSwapVisualService=function(){return this.resolve("SwapVisualService")},t.prototype.getChainReactionService=function(){return this.resolve("ChainReactionService")},t.prototype.getHintService=function(){return this.resolve("HintService")},t.reset=function(){t.gameInstance&&(t.gameInstance.clear(),t.gameInstance=null)},t}(r.ServiceContainer);o.GameServiceContainer=g,cc._RF.pop()},{"../features/tiles/TileFactory":"TileFactory","../game/managers/BoosterManager":"BoosterManager","../game/managers/UICommandService":"UICommandService","../game/services/AnimationService":"AnimationService","../game/services/ChainReactionService":"ChainReactionService","../game/services/CoordinateService":"CoordinateService","../game/services/HintService":"HintService","../game/services/SwapVisualService":"SwapVisualService","../shared/config/GameConfig":"GameConfig","./EventBus":"EventBus","./ServiceContainer":"ServiceContainer"}],GameState:[function(e,t,o){"use strict";cc._RF.push(t,"0cdd9xM/FROPKf5On/1pTW6","GameState"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameState=void 0;var i=function(){function e(e,t){this.score=0,this.targetScore=0,this.movesLeft=0,this.totalMoves=0,this.shufflesLeft=3,this.isGameOver=!1,this.isWin=!1,this.targetScore=e,this.totalMoves=t,this.movesLeft=t}return e.prototype.reset=function(e,t){this.score=0,this.targetScore=e,this.totalMoves=t,this.movesLeft=t,this.shufflesLeft=3,this.isGameOver=!1,this.isWin=!1},e}();o.GameState=i,cc._RF.pop()},{}],GameTypes:[function(e,t,o){"use strict";cc._RF.push(t,"3f96fwxvOBMtYYYWOR4HxC6","GameTypes"),Object.defineProperty(o,"__esModule",{value:!0}),o.GameState=void 0,function(e){e[e.PLAYING=0]="PLAYING",e[e.WON=1]="WON",e[e.LOST=2]="LOST"}(o.GameState||(o.GameState={})),cc._RF.pop()},{}],HeaderPanel:[function(e,t,o){"use strict";cc._RF.push(t,"4bb93ueKexMML0aszqZb+m0","HeaderPanel");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../core/EventBus"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.scoreLabel=null,t.movesLabel=null,t.shufflesLabel=null,t}return n(t,e),t.prototype.onLoad=function(){this.eventBus=s.EventBus.getInstance(),this.setupEventListeners()},t.prototype.setupEventListeners=function(){this.eventBus.subscribe(s.UICommands.UPDATE_SCORE,this.onUpdateScore,this),this.eventBus.subscribe(s.UICommands.UPDATE_MOVES,this.onUpdateMoves,this),this.eventBus.subscribe(s.UICommands.UPDATE_SHUFFLES,this.onUpdateShuffles,this)},t.prototype.onUpdateScore=function(e){this.scoreLabel&&(this.scoreLabel.string=e)},t.prototype.onUpdateMoves=function(e){this.movesLabel&&(this.movesLabel.string=e)},t.prototype.onUpdateShuffles=function(e){this.shufflesLabel&&(this.shufflesLabel.string=e)},t.prototype.onDestroy=function(){this.eventBus&&(this.eventBus.unsubscribe(s.UICommands.UPDATE_SCORE,this.onUpdateScore,this),this.eventBus.unsubscribe(s.UICommands.UPDATE_MOVES,this.onUpdateMoves,this),this.eventBus.unsubscribe(s.UICommands.UPDATE_SHUFFLES,this.onUpdateShuffles,this))},r([u(cc.Label)],t.prototype,"scoreLabel",void 0),r([u(cc.Label)],t.prototype,"movesLabel",void 0),r([u(cc.Label)],t.prototype,"shufflesLabel",void 0),r([c],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../../core/EventBus":"EventBus"}],HintService:[function(e,t,o){"use strict";cc._RF.push(t,"e9013ntQz5PTJR5CR69AOmT","HintService"),Object.defineProperty(o,"__esModule",{value:!0}),o.HintService=void 0;var i=e("../../core/EventBus"),n=function(){function e(){this.hintTimer=null,this.hintDelay=1e4,this.isHintActive=!1,this.eventBus=i.EventBus.getInstance(),this.setupEventListeners(),this.startHintTimer()}return e.prototype.setupEventListeners=function(){this.eventBus.subscribe(i.GameEvents.TILE_CLICKED,this.resetHintTimer,this),this.eventBus.subscribe(i.GameEvents.BOOSTER_ACTIVATION_REQUESTED,this.resetHintTimer,this),this.eventBus.subscribe(i.GameEvents.ANIMATION_COMPLETED,this.resetHintTimer,this)},e.prototype.resetHintTimer=function(){var e=this;this.stopCurrentHint(),null!==this.hintTimer&&clearTimeout(this.hintTimer),this.hintTimer=setTimeout(function(){e.onInactivityTimeout()},this.hintDelay)},e.prototype.onInactivityTimeout=function(){this.eventBus.publish(i.GameEvents.HINT_REQUEST)},e.prototype.showHint=function(e){this.isHintActive&&this.stopCurrentHint(),e&&e.length>0&&(this.isHintActive=!0,this.eventBus.publish(i.UICommands.HINT_ANIMATION_START,{positions:e}))},e.prototype.stopCurrentHint=function(){this.isHintActive&&(this.isHintActive=!1,this.eventBus.publish(i.UICommands.HINT_ANIMATION_STOP))},e.prototype.startHintTimer=function(){this.resetHintTimer()},e.prototype.stopHintTimer=function(){null!==this.hintTimer&&(clearTimeout(this.hintTimer),this.hintTimer=null),this.stopCurrentHint()},e.prototype.destroy=function(){this.stopHintTimer(),this.eventBus&&(this.eventBus.unsubscribe(i.GameEvents.TILE_CLICKED,this.resetHintTimer,this),this.eventBus.unsubscribe(i.GameEvents.BOOSTER_ACTIVATION_REQUESTED,this.resetHintTimer,this),this.eventBus.unsubscribe(i.GameEvents.ANIMATION_COMPLETED,this.resetHintTimer,this))},e}();o.HintService=n,cc._RF.pop()},{"../../core/EventBus":"EventBus"}],MainScene:[function(e,t,o){"use strict";cc._RF.push(t,"54ff8ttk9JJ7KcdSty2CdeA","MainScene");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("./core/EventBus"),a=e("./core/GameController"),c=e("./core/UIController"),u=e("./core/GameServiceContainer"),l=e("./shared/console/DevConsole"),p=cc._decorator.ccclass,h=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.onLoad=function(){this.eventBus=s.EventBus.getInstance(),this.setupEventListeners(),this.initializeGameCoordinator(),this.setupDevConsole()},t.prototype.initializeGameCoordinator=function(){this.serviceContainer=u.GameServiceContainer.getGameInstance(),this.gameController=new a.default,this.uiController=new c.UIController(this.gameController),this.serviceContainer.getUICommandService().initializeUI()},t.prototype.setupDevConsole=function(){this.devConsole=new l.DevConsole(this.gameController,this),this.devConsole.setupCommands()},t.prototype.restartGame=function(){var e=this.serviceContainer.getUICommandService();this.gameController.resetGame(),e.hideGameOver()},t.prototype.setupEventListeners=function(){this.eventBus.subscribe(s.GameEvents.GAME_RESTART_REQUESTED,this.handleRestartRequested,this)},t.prototype.handleRestartRequested=function(){this.restartGame()},t.prototype.shutdown=function(){this.devConsole&&this.devConsole.destroy(),this.uiController&&this.uiController.destroy(),this.eventBus.unsubscribe(s.GameEvents.GAME_RESTART_REQUESTED,this.handleRestartRequested,this)},t.prototype.onDestroy=function(){this.shutdown()},r([p],t)}(cc.Component);o.default=h,cc._RF.pop()},{"./core/EventBus":"EventBus","./core/GameController":"GameController","./core/GameServiceContainer":"GameServiceContainer","./core/UIController":"UIController","./shared/console/DevConsole":"DevConsole"}],MovesManager:[function(e,t,o){"use strict";cc._RF.push(t,"fc8cddYaG5NPoHd3AVNu5mF","MovesManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.MovesManager=void 0;var i=function(){function e(e){this.gameState=e}return e.prototype.useMove=function(){return this.gameState.movesLeft>0&&(this.gameState.movesLeft--,!0)},e.prototype.hasMovesLeft=function(){return this.gameState.movesLeft>0},e.prototype.getMovesLeft=function(){return this.gameState.movesLeft},e.prototype.getTotalMoves=function(){return this.gameState.totalMoves},e.prototype.addMoves=function(e){this.gameState.movesLeft+=e},e.prototype.reset=function(){this.gameState.movesLeft=this.gameState.totalMoves},e}();o.MovesManager=i,cc._RF.pop()},{}],RegularTile:[function(e,t,o){"use strict";cc._RF.push(t,"8bfd8fplLBB9rsfi9Nashq1","RegularTile");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.RegularTile=void 0;var r=e("../base/BaseTile"),s=e("../../../shared/config/GameConfig"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.getTargets=function(e){return this.getConnectedTiles(e,this.position.row,this.position.col)},t.prototype.canActivate=function(e){var t=this.getTargets(e),o=s.GameConfig.getInstance().getCurrentLevel().minimumGroupSize;return t.length>=o},t.prototype.activate=function(e){var t=this.getTargets(e);return{removed:t,points:this.calculatePoints(t.length)}},t.prototype.getConnectedTiles=function(e,t,o){for(var i=this,n=[],r=[],s=0;s<e.rows;s++){n[s]=[];for(var a=0;a<e.cols;a++)n[s][a]=!1}var c=function(t,o){if(e.isValidPosition(t,o)&&!n[t][o]){var s=e.getTile(t,o);s&&s.type===i.type&&(n[t][o]=!0,r.push({row:t,col:o}),c(t-1,o),c(t+1,o),c(t,o-1),c(t,o+1))}};return c(t,o),r},t.prototype.calculatePoints=function(e){return 10*e+Math.max(0,5*(e-3))},t}(r.BaseTile);o.RegularTile=a,cc._RF.pop()},{"../../../shared/config/GameConfig":"GameConfig","../base/BaseTile":"BaseTile"}],ScoreManager:[function(e,t,o){"use strict";cc._RF.push(t,"ee40a7wdKRE34UmvZvyB1R0","ScoreManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScoreManager=void 0;var i=function(){function e(e){this.gameState=e}return e.prototype.addScore=function(e){return this.gameState.score+=e,e},e.prototype.isTargetReached=function(){return this.gameState.score>=this.gameState.targetScore},e.prototype.getProgress=function(){return Math.min(this.gameState.score/this.gameState.targetScore,1)},e.prototype.getScore=function(){return this.gameState.score},e.prototype.getTargetScore=function(){return this.gameState.targetScore},e.prototype.reset=function(){this.gameState.score=0},e}();o.ScoreManager=i,cc._RF.pop()},{}],ScorePopupManager:[function(e,t,o){"use strict";cc._RF.push(t,"17f02OePexF+r3KA+oeq+3F","ScorePopupManager"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScorePopupManager=void 0;var i=e("../UITypes"),n=function(){function e(){this.popupContainer=null,this.activePopups=[]}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setPopupContainer=function(e){this.popupContainer=e},e.prototype.showPointsAt=function(e,t,o){if(void 0===o&&(o=i.ScorePopupType.NORMAL),this.popupContainer){var n={points:e,type:this.determinePopupType(e,o),startPosition:this.popupContainer.convertToNodeSpaceAR(t),duration:1.5,showPlusSign:!0,fontSize:this.getFontSizeForPoints(e)};this.showScorePopup(n)}},e.prototype.showScorePopup=function(e){if(this.popupContainer){var t=this.createScorePopup(e);t&&(this.popupContainer.addChild(t),this.activePopups.push(t),this.animateScorePopup(t))}},e.prototype.clear=function(){this.activePopups.forEach(function(e){e&&cc.isValid(e)&&e.destroy()}),this.activePopups=[]},e.prototype.determinePopupType=function(e,t){return t!==i.ScorePopupType.NORMAL?t:e>=200?i.ScorePopupType.COMBO:e>=100?i.ScorePopupType.SUPER:e>=50?i.ScorePopupType.BONUS:i.ScorePopupType.NORMAL},e.prototype.getFontSizeForPoints=function(e){return e>=200?60:e>=100?48:e>=50?36:e>=20?30:24},e.prototype.createScorePopup=function(e){var t=new cc.Node("ScorePopup"),o=t.addComponent(cc.Label),i=e.showPlusSign?"+"+e.points:e.points.toString();return o.string=i,o.fontFamily="Marvin",o.fontSize=e.fontSize||24,this.setupPopupStyle(o,e.type),t.setPosition(e.startPosition),t.opacity=255,t.scale=.5,t},e.prototype.setupPopupStyle=function(e,t){e.node.color=this.getColorForType(t);var o=e.node.addComponent(cc.LabelOutline);o.color=cc.Color.BLACK,o.width=2;var i=e.node.addComponent(cc.LabelShadow);i.color=new cc.Color(0,0,0,100),i.offset=new cc.Vec2(2,-2),i.blur=1},e.prototype.getColorForType=function(e){switch(e){case i.ScorePopupType.NORMAL:return cc.Color.WHITE;case i.ScorePopupType.BONUS:return cc.Color.YELLOW;case i.ScorePopupType.SUPER:return new cc.Color(255,215,0);case i.ScorePopupType.COMBO:return cc.Color.MAGENTA;default:return cc.Color.WHITE}},e.prototype.animateScorePopup=function(e){var t=this;cc.tween(e).to(.2,{scale:1.2,opacity:255},{easing:"backOut"}).call(function(){t.animateRiseAndFade(e)}).start()},e.prototype.animateRiseAndFade=function(e){var t=this;cc.tween(e).to(.8,{scale:1,y:e.y+80},{easing:"sineOut"}).start(),cc.tween(e).to(.5,{opacity:0},{easing:"sineIn"}).call(function(){t.removePopup(e)}).start()},e.prototype.removePopup=function(e){var t=this.activePopups.indexOf(e);t>-1&&this.activePopups.splice(t,1),cc.isValid(e)&&e.destroy()},e}();o.ScorePopupManager=n,cc._RF.pop()},{"../UITypes":"UITypes"}],ScorePopupView:[function(e,t,o){"use strict";cc._RF.push(t,"cf79bLb5JZJDaoswGSFNnhu","ScorePopupView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../managers/ScorePopupManager"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.popupContainer=null,t}return n(t,e),t.prototype.onLoad=function(){this.scorePopupManager=s.ScorePopupManager.getInstance(),this.setupScorePopupManager(),this.popupContainer||console.error("[ScorePopupView] popupContainer \u043d\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d!")},t.prototype.setupScorePopupManager=function(){this.popupContainer&&this.scorePopupManager.setPopupContainer(this.popupContainer)},t.prototype.onDestroy=function(){this.scorePopupManager.clear()},r([u(cc.Node)],t.prototype,"popupContainer",void 0),r([c],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../managers/ScorePopupManager":"ScorePopupManager"}],ServiceContainer:[function(e,t,o){"use strict";cc._RF.push(t,"457066EZS5Fk7lhdXvLhK/3","ServiceContainer"),Object.defineProperty(o,"__esModule",{value:!0}),o.ServiceContainer=void 0;var i=function(){function e(){this.services=new Map,this.singletons=new Map,this.factories=new Map}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.register=function(e,t){this.factories.set(e,t)},e.prototype.registerSingleton=function(e,t){this.factories.set(e,t),this.singletons.set(e,null)},e.prototype.resolve=function(e){if(this.singletons.has(e)){var t=this.singletons.get(e);if(null===t){var o=this.factories.get(e);if(!o)throw new Error("Service not registered: "+e);t=o(),this.singletons.set(e,t)}return t}var i=this.factories.get(e);if(!i)throw new Error("Service not registered: "+e);return i()},e.prototype.registerInstance=function(e,t){this.services.set(e,t)},e.prototype.hasService=function(e){return this.factories.has(e)||this.services.has(e)},e.prototype.clear=function(){this.services.clear(),this.singletons.clear(),this.factories.clear()},e}();o.ServiceContainer=i,cc._RF.pop()},{}],ShuffleButton:[function(e,t,o){"use strict";cc._RF.push(t,"d058c14m7xOcoHRuzoFXnHM","ShuffleButton");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../core/EventBus"),a=cc._decorator,c=a.ccclass,u=a.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.shuffleButton=null,t}return n(t,e),t.prototype.onLoad=function(){this.eventBus=s.EventBus.getInstance(),this.setupButtonListener()},t.prototype.setupButtonListener=function(){this.shuffleButton&&this.shuffleButton.node.on("click",this.onShuffleButtonClicked,this)},t.prototype.onShuffleButtonClicked=function(){this.eventBus.publish(s.GameEvents.SHUFFLE_REQUESTED)},t.prototype.onDestroy=function(){this.shuffleButton&&this.shuffleButton.node.off("click",this.onShuffleButtonClicked,this)},r([u(cc.Button)],t.prototype,"shuffleButton",void 0),r([c],t)}(cc.Component);o.default=l,cc._RF.pop()},{"../../core/EventBus":"EventBus"}],SuperAllTile:[function(e,t,o){"use strict";cc._RF.push(t,"9da44A4hM5KXpY8tRRbTm0D","SuperAllTile");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.SuperAllTile=void 0;var r=e("./BaseSuperTile"),s=e("../TileTypes"),a=function(e){function t(t){return e.call(this,s.TileType.SUPER_ALL,t,50)||this}return n(t,e),t.prototype.getTargets=function(e){for(var t=[],o=0;o<e.rows;o++)for(var i=0;i<e.cols;i++)t.push({row:o,col:i});return t},t.prototype.findAffectedSuperTiles=function(){return[]},t}(r.BaseSuperTile);o.SuperAllTile=a,cc._RF.pop()},{"../TileTypes":"TileTypes","./BaseSuperTile":"BaseSuperTile"}],SuperBombTile:[function(e,t,o){"use strict";cc._RF.push(t,"44e66zXSEVGSrxQgscaE8pF","SuperBombTile");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.SuperBombTile=void 0;var r=e("./BaseSuperTile"),s=e("../TileTypes"),a=function(e){function t(t){return e.call(this,s.TileType.SUPER_BOMB,t,25)||this}return n(t,e),t.prototype.getTargets=function(e){for(var t=[],o=this.position.row-2;o<=this.position.row+2;o++)for(var i=this.position.col-2;i<=this.position.col+2;i++)e.isValidPosition(o,i)&&t.push({row:o,col:i});return t},t}(r.BaseSuperTile);o.SuperBombTile=a,cc._RF.pop()},{"../TileTypes":"TileTypes","./BaseSuperTile":"BaseSuperTile"}],SuperColTile:[function(e,t,o){"use strict";cc._RF.push(t,"74834J5sbBBvowSo6On1Heq","SuperColTile");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.SuperColTile=void 0;var r=e("./BaseSuperTile"),s=e("../TileTypes"),a=function(e){function t(t){return e.call(this,s.TileType.SUPER_COLUMN,t,20)||this}return n(t,e),t.prototype.getTargets=function(e){for(var t=[],o=0;o<e.rows;o++)t.push({row:o,col:this.position.col});return t},t}(r.BaseSuperTile);o.SuperColTile=a,cc._RF.pop()},{"../TileTypes":"TileTypes","./BaseSuperTile":"BaseSuperTile"}],SuperRowTile:[function(e,t,o){"use strict";cc._RF.push(t,"0094bfWW8tDaYj/Ut38j/1/","SuperRowTile");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)});Object.defineProperty(o,"__esModule",{value:!0}),o.SuperRowTile=void 0;var r=e("./BaseSuperTile"),s=e("../TileTypes"),a=function(e){function t(t){return e.call(this,s.TileType.SUPER_ROW,t,20)||this}return n(t,e),t.prototype.getTargets=function(e){for(var t=[],o=0;o<e.cols;o++)t.push({row:this.position.row,col:o});return t},t}(r.BaseSuperTile);o.SuperRowTile=a,cc._RF.pop()},{"../TileTypes":"TileTypes","./BaseSuperTile":"BaseSuperTile"}],SuperTileRules:[function(e,t,o){"use strict";cc._RF.push(t,"78e42/46ZpPOpZzhtWTb11e","SuperTileRules"),Object.defineProperty(o,"__esModule",{value:!0}),o.SuperTileRules=void 0;var i=e("../../features/tiles/TileTypes"),n=function(){function e(){}return e.prototype.determineSuperTileType=function(e){var t=e.length;if(t<5)return null;if(t>=9)return i.TileType.SUPER_ALL;if(t>=7)return i.TileType.SUPER_BOMB;var o=this.analyzeGroupGeometry(e);return o.uniqueRows>o.uniqueCols?i.TileType.SUPER_COLUMN:i.TileType.SUPER_ROW},e.prototype.analyzeGroupGeometry=function(e){return{uniqueRows:new Set(e.map(function(e){return e.row})).size,uniqueCols:new Set(e.map(function(e){return e.col})).size}},e}();o.SuperTileRules=n,cc._RF.pop()},{"../../features/tiles/TileTypes":"TileTypes"}],SwapBoosterStrategy:[function(e,t,o){"use strict";cc._RF.push(t,"59644Un6GFHKIMAh96rn37Z","SwapBoosterStrategy"),Object.defineProperty(o,"__esModule",{value:!0}),o.SwapBoosterStrategy=void 0;var i=e("../BoostersTypes"),n=e("../../../game/services/SwapVisualService"),r=function(){function e(){this.type=i.BoosterType.SWAP,this.firstClick=null,this.swapVisualService=n.SwapVisualService.getInstance()}return e.prototype.canActivate=function(e,t){return e.isValidPosition(t.row,t.col)},e.prototype.activate=function(e,t){if(!this.canActivate(e,t))return{success:!1,needsSecondClick:!1};if(this.firstClick){var o=this.firstClick,i=this.performSwap(e,this.firstClick,t);return this.swapVisualService.putDownTile(o),this.firstClick=null,i}return this.firstClick={row:t.row,col:t.col},this.swapVisualService.liftTile(this.firstClick),{success:!1,needsSecondClick:!0}},e.prototype.needsSecondClick=function(){return null!==this.firstClick},e.prototype.getHintMessage=function(){return this.firstClick?"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0432\u0442\u043e\u0440\u043e\u0439 \u0442\u0430\u0439\u043b \u0434\u043b\u044f \u043e\u0431\u043c\u0435\u043d\u0430":"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0435\u0440\u0432\u044b\u0439 \u0442\u0430\u0439\u043b \u0434\u043b\u044f \u043e\u0431\u043c\u0435\u043d\u0430"},e.prototype.reset=function(){this.firstClick&&this.swapVisualService.putDownTile(this.firstClick),this.firstClick=null},e.prototype.performSwap=function(e,t,o){if(t.row===o.row&&t.col===o.col)return{success:!1,needsSecondClick:!1};var i=e.getTile(t.row,t.col),n=e.getTile(o.row,o.col);return i&&n?(i.position.row=o.row,i.position.col=o.col,n.position.row=t.row,n.position.col=t.col,e.setTile(t.row,t.col,n),e.setTile(o.row,o.col,i),{success:!0,needsSecondClick:!1,swappedTile:{pos1:t,pos2:o},points:5}):{success:!1,needsSecondClick:!1}},e}();o.SwapBoosterStrategy=r,cc._RF.pop()},{"../../../game/services/SwapVisualService":"SwapVisualService","../BoostersTypes":"BoostersTypes"}],SwapVisualService:[function(e,t,o){"use strict";cc._RF.push(t,"95c588+n0tMKYrLlNdYzVAl","SwapVisualService");var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,o=arguments.length;t<o;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<o;t++)for(var r=arguments[t],s=0,a=r.length;s<a;s++,n++)i[n]=r[s];return i};Object.defineProperty(o,"__esModule",{value:!0}),o.SwapVisualService=void 0;var n=function(){function e(){this.getTileView=null,this.liftedTiles=[]}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.setTileViewProvider=function(e){this.getTileView=e},e.prototype.liftTile=function(e){if(this.getTileView){var t=this.getTileView(e.row,e.col);t&&t.liftUp&&(t.liftUp(),this.liftedTiles.push(e))}},e.prototype.putDownTile=function(e){if(this.getTileView){var t=this.getTileView(e.row,e.col);t&&t.putDown&&(t.putDown(),this.liftedTiles=this.liftedTiles.filter(function(t){return!(t.row===e.row&&t.col===e.col)}))}},e.prototype.putDownAllTiles=function(){var e=this;i(this.liftedTiles).forEach(function(t){e.putDownTile(t)}),this.liftedTiles=[]},e.prototype.destroy=function(){this.putDownAllTiles()},e}();o.SwapVisualService=n,cc._RF.pop()},{}],TileFactory:[function(e,t,o){"use strict";cc._RF.push(t,"63987wY5mRMJI/S6yI1Vxuy","TileFactory"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileFactory=void 0;var i=e("./TileTypes"),n=e("../../shared/utils/TileUtils"),r=e("./regular/RegularTile"),s=e("./super/SuperRowTile"),a=e("./super/SuperColTile"),c=e("./super/SuperBombTile"),u=e("./super/SuperAllTile"),l=function(){function e(){}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.createTile=function(e,t){switch(e){case i.TileType.RED:case i.TileType.BLUE:case i.TileType.GREEN:case i.TileType.YELLOW:case i.TileType.PURPLE:return new r.RegularTile(e,t);case i.TileType.SUPER_ROW:return new s.SuperRowTile(t);case i.TileType.SUPER_COLUMN:return new a.SuperColTile(t);case i.TileType.SUPER_BOMB:return new c.SuperBombTile(t);case i.TileType.SUPER_ALL:return new u.SuperAllTile(t);default:throw new Error("Unknown tile type: "+e)}},e.prototype.createRandomRegularTile=function(e){var t=n.TileUtils.getRegularTileTypes(),o=t[Math.floor(Math.random()*t.length)];return this.createTile(o,e)},e}();o.TileFactory=l,cc._RF.pop()},{"../../shared/utils/TileUtils":"TileUtils","./TileTypes":"TileTypes","./regular/RegularTile":"RegularTile","./super/SuperAllTile":"SuperAllTile","./super/SuperBombTile":"SuperBombTile","./super/SuperColTile":"SuperColTile","./super/SuperRowTile":"SuperRowTile"}],TileTypes:[function(e,t,o){"use strict";cc._RF.push(t,"4c7b4fTGydKkJtpJIaQu8DM","TileTypes"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileType=void 0,function(e){e.RED="red",e.BLUE="blue",e.GREEN="green",e.YELLOW="yellow",e.PURPLE="purple",e.SUPER_ROW="super_row",e.SUPER_COLUMN="super_column",e.SUPER_BOMB="super_bomb",e.SUPER_ALL="super_all"}(o.TileType||(o.TileType={})),cc._RF.pop()},{}],TileUtils:[function(e,t,o){"use strict";cc._RF.push(t,"40f7e1hD/9JSpgX1sQKPHJl","TileUtils"),Object.defineProperty(o,"__esModule",{value:!0}),o.TileUtils=void 0;var i=e("../../features/tiles/TileTypes"),n=function(){function e(){}return e.getRegularTileTypes=function(){return[i.TileType.RED,i.TileType.BLUE,i.TileType.GREEN,i.TileType.YELLOW,i.TileType.PURPLE]},e.getSuperTileTypes=function(){return[i.TileType.SUPER_ROW,i.TileType.SUPER_COLUMN,i.TileType.SUPER_BOMB,i.TileType.SUPER_ALL]},e.isSuperTile=function(e){return this.getSuperTileTypes().includes(e)},e.isRegularTile=function(e){return this.getRegularTileTypes().includes(e)},e}();o.TileUtils=n,cc._RF.pop()},{"../../features/tiles/TileTypes":"TileTypes"}],TileView:[function(e,t,o){"use strict";cc._RF.push(t,"94286IPDFNK0bYwA/C9tbMM","TileView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../features/tiles/TileTypes"),a=e("../../shared/utils/TileUtils"),c=cc._decorator,u=c.ccclass,l=c.property,p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.redSprite=null,t.blueSprite=null,t.greenSprite=null,t.yellowSprite=null,t.purpleSprite=null,t.superRowSprite=null,t.superColumnSprite=null,t.superBombSprite=null,t.superAllSprite=null,t.type=null,t.row=-1,t.col=-1,t.pulseTween=null,t}return n(t,e),t.prototype.onLoad=function(){this.node.on(cc.Node.EventType.TOUCH_END,this.onTileClicked,this)},t.prototype.setType=function(e){this.type=e,this.updateSprite()},t.prototype.setGridPosition=function(e,t){this.row=e,this.col=t},t.prototype.updateSprite=function(){var e=this.getComponent(cc.Sprite);if(e){switch(this.type){case s.TileType.RED:e.spriteFrame=this.redSprite;break;case s.TileType.BLUE:e.spriteFrame=this.blueSprite;break;case s.TileType.GREEN:e.spriteFrame=this.greenSprite;break;case s.TileType.YELLOW:e.spriteFrame=this.yellowSprite;break;case s.TileType.PURPLE:e.spriteFrame=this.purpleSprite;break;case s.TileType.SUPER_ROW:e.spriteFrame=this.superRowSprite;break;case s.TileType.SUPER_COLUMN:e.spriteFrame=this.superColumnSprite;break;case s.TileType.SUPER_BOMB:e.spriteFrame=this.superBombSprite;break;case s.TileType.SUPER_ALL:e.spriteFrame=this.superAllSprite}a.TileUtils.isSuperTile(this.type)?this.addPulseEffect():this.removePulseEffect()}},t.prototype.addPulseEffect=function(){this.removePulseEffect(),this.pulseTween=cc.tween(this.node).repeatForever(cc.tween().to(.8,{scale:1.1},{easing:"sineInOut"}).to(.8,{scale:1},{easing:"sineInOut"})).start()},t.prototype.removePulseEffect=function(){this.pulseTween&&(this.pulseTween.stop(),this.pulseTween=null),this.node.scale=1},t.prototype.onTileClicked=function(){if(void 0!==this.row&&void 0!==this.col&&-1!==this.row&&-1!==this.col){var e={row:this.row,col:this.col},t=new cc.Event.EventCustom("tile-clicked",!0);t.setUserData(e),this.node.dispatchEvent(t)}else console.error("[TileView.onTileClicked] row ("+this.row+") \u0438\u043b\u0438 col ("+this.col+") \u043d\u0435 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u044b!")},t.prototype.getType=function(){return this.type},t.prototype.getRow=function(){return this.row},t.prototype.getCol=function(){return this.col},t.prototype.getGridPosition=function(){return{row:this.row,col:this.col}},t.prototype.liftUp=function(){cc.Tween.stopAllByTarget(this.node),this.zIndex=this.node.zIndex,this.node.zIndex=1e3,cc.tween(this.node).to(.2,{scale:1.1,y:this.node.y+10},{easing:"backOut"}).start(),cc.tween(this.node).delay(.2).then(cc.tween().repeatForever(cc.tween().to(.3,{scale:1.15}).to(.3,{scale:1.1}))).start()},t.prototype.putDown=function(){var e=this;cc.Tween.stopAllByTarget(this.node),this.node.zIndex=this.zIndex,cc.tween(this.node).to(.2,{scale:1,y:this.node.y-10},{easing:"sineIn"}).call(function(){a.TileUtils.isSuperTile(e.type)&&e.addPulseEffect()}).start()},t.prototype.isLifted=function(){return 1e3===this.node.zIndex},t.prototype.onDestroy=function(){this.removePulseEffect(),cc.Tween.stopAllByTarget(this.node)},r([l(cc.SpriteFrame)],t.prototype,"redSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"blueSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"greenSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"yellowSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"purpleSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"superRowSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"superColumnSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"superBombSprite",void 0),r([l(cc.SpriteFrame)],t.prototype,"superAllSprite",void 0),r([u],t)}(cc.Component);o.default=p,cc._RF.pop()},{"../../features/tiles/TileTypes":"TileTypes","../../shared/utils/TileUtils":"TileUtils"}],ToastManager:[function(e,t,o){"use strict";cc._RF.push(t,"cb987F13/xECoHZkU6eNzUC","ToastManager");var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(o,"__esModule",{value:!0}),o.ToastManager=void 0;var n=e("../UITypes"),r=e("../../core/EventBus"),s=function(){function e(){this.toastQueue=[],this.activeToasts=0,this.maxActiveToasts=1,this.eventBus=r.EventBus.getInstance()}return e.getInstance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.show=function(e){var t=i({duration:1.5,showCloseButton:!1,position:"top"},e);this.activeToasts<this.maxActiveToasts?this.displayToast(t):this.toastQueue.push(t)},e.prototype.showSuccess=function(e,t){void 0===t&&(t=3),this.show({message:e,type:n.ToastType.SUCCESS,duration:t})},e.prototype.showError=function(e,t){void 0===t&&(t=5),this.show({message:e,type:n.ToastType.ERROR,duration:t,showCloseButton:!0})},e.prototype.showInfo=function(e,t){void 0===t&&(t=3),this.show({message:e,type:n.ToastType.INFO,duration:t})},e.prototype.showWarning=function(e,t){void 0===t&&(t=4),this.show({message:e,type:n.ToastType.WARNING,duration:t})},e.prototype.clear=function(){this.toastQueue=[],this.eventBus.publish(r.UICommands.TOAST_CLEAR_ALL),this.activeToasts=0},e.prototype.displayToast=function(e){var t=this;this.activeToasts++,this.eventBus.publish(r.UICommands.TOAST_SHOW,e),e.duration&&e.duration>0&&setTimeout(function(){t.hideToast()},1e3*e.duration)},e.prototype.hideToast=function(){if(this.activeToasts=Math.max(0,this.activeToasts-1),this.toastQueue.length>0&&this.activeToasts<this.maxActiveToasts){var e=this.toastQueue.shift();e&&this.displayToast(e)}},e.prototype.onToastClosed=function(){this.hideToast()},e}();o.ToastManager=s,cc._RF.pop()},{"../../core/EventBus":"EventBus","../UITypes":"UITypes"}],ToastView:[function(e,t,o){"use strict";cc._RF.push(t,"088beXcdzdCk4JcJb/6v9ZD","ToastView");var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])})(e,t)},function(e,t){function o(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}),r=this&&this.__decorate||function(e,t,o,i){var n,r=arguments.length,s=r<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,o):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,o,i);else for(var a=e.length-1;a>=0;a--)(n=e[a])&&(s=(r<3?n(s):r>3?n(t,o,s):n(t,o))||s);return r>3&&s&&Object.defineProperty(t,o,s),s};Object.defineProperty(o,"__esModule",{value:!0});var s=e("../../core/EventBus"),a=e("../managers/ToastManager"),c=e("../../shared/constants/ZIndexConstants"),u=cc._decorator,l=u.ccclass,p=u.property,h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.toastContainer=null,t.toastPrefab=null,t.activeToasts=[],t}return n(t,e),t.prototype.onLoad=function(){this.eventBus=s.EventBus.getInstance(),this.toastManager=a.ToastManager.getInstance(),this.setupEventListeners(),this.toastContainer?this.toastContainer.zIndex=c.ZIndexConstants.TOAST_MESSAGES:console.error("[ToastView] toastContainer \u043d\u0435 \u043d\u0430\u0437\u043d\u0430\u0447\u0435\u043d!")},t.prototype.setupEventListeners=function(){this.eventBus.subscribe(s.UICommands.TOAST_SHOW,this.onShowToast,this),this.eventBus.subscribe(s.UICommands.TOAST_CLEAR_ALL,this.onClearAll,this)},t.prototype.onShowToast=function(e){this.createToast(e)},t.prototype.onClearAll=function(){this.activeToasts.forEach(function(e){e&&cc.isValid(e)&&e.destroy()}),this.activeToasts=[]},t.prototype.createToast=function(e){if(this.toastContainer){var t=cc.instantiate(this.toastPrefab);t?(this.setupToast(t,e),this.toastContainer.addChild(t),this.activeToasts.push(t),this.positionToast(t,e.position||"top"),this.animateToastIn(t),e.duration&&e.duration>0&&this.scheduleToastHide(t,e.duration)):console.error("[ToastView] \u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0437\u0434\u0430\u0442\u044c toast node")}else console.error("[ToastView] \u041d\u0435\u0442 \u043a\u043e\u043d\u0442\u0435\u0439\u043d\u0435\u0440\u0430 \u0434\u043b\u044f toast'\u043e\u0432")},t.prototype.setupToast=function(e,t){e.name="Toast_"+t.type+"_"+Date.now();var o=e.getChildByName("Overlay"),i=e.getChildByName("Message");i.getComponent(cc.Label).string=t.message,this.scheduleOnce(function(){var e=i.getContentSize();o.setContentSize(e.width+100,e.height+50)},0),e.toastConfig=t},t.prototype.positionToast=function(e,t){var o=this.toastContainer.getContentSize(),i=e.getContentSize(),n=0;switch(t){case"top":n=o.height/2-i.height/2-20;break;case"center":n=0;break;case"bottom":n=-o.height/2+i.height/2+20}n-=(this.activeToasts.filter(function(e){var o=e.toastConfig;return o&&o.position===t}).length-1)*(i.height+10),e.setPosition(0,n)},t.prototype.animateToastIn=function(e){e.opacity=0,e.scale=.8,cc.tween(e).to(.3,{opacity:255,scale:1},{easing:"backOut"}).start()},t.prototype.animateToastOut=function(e,t){cc.tween(e).to(.2,{opacity:0,scale:.8},{easing:"backIn"}).call(function(){t&&t()}).start()},t.prototype.scheduleToastHide=function(e,t){var o=this;setTimeout(function(){o.hideToast(e)},1e3*t)},t.prototype.hideToast=function(e){var t=this;e&&cc.isValid(e)&&this.animateToastOut(e,function(){var o=t.activeToasts.indexOf(e);o>-1&&t.activeToasts.splice(o,1),cc.isValid(e)&&e.destroy(),t.toastManager.onToastClosed()})},t.prototype.onDestroy=function(){this.eventBus&&(this.eventBus.unsubscribe(s.UICommands.TOAST_SHOW,this.onShowToast,this),this.eventBus.unsubscribe(s.UICommands.TOAST_CLEAR_ALL,this.onClearAll,this)),this.onClearAll()},r([p(cc.Node)],t.prototype,"toastContainer",void 0),r([p(cc.Prefab)],t.prototype,"toastPrefab",void 0),r([l],t)}(cc.Component);o.default=h,cc._RF.pop()},{"../../core/EventBus":"EventBus","../../shared/constants/ZIndexConstants":"ZIndexConstants","../managers/ToastManager":"ToastManager"}],UICommandService:[function(e,t,o){"use strict";cc._RF.push(t,"6db9a9A+EVOD7KD0A63E5zq","UICommandService"),Object.defineProperty(o,"__esModule",{value:!0}),o.UICommandService=void 0;var i=e("../../core/EventBus"),n=e("../../ui/managers/ToastManager"),r=e("../../ui/managers/ScorePopupManager"),s=e("../services/CoordinateService"),a=function(){function e(){this.eventBus=i.EventBus.getInstance(),this.toastManager=n.ToastManager.getInstance(),this.scorePopupManager=r.ScorePopupManager.getInstance(),this.coordinateService=s.CoordinateService.getInstance()}return e.prototype.initializeUI=function(){this.eventBus.publish(i.UICommands.INITIALIZE_GAME_OVER,!1)},e.prototype.initializeBoard=function(e,t,o){this.eventBus.publish(i.UICommands.BOARD_INIT,{rows:e,cols:t,getTileType:o})},e.prototype.updateScore=function(e,t){this.eventBus.publish(i.UICommands.UPDATE_SCORE,e+"/"+t)},e.prototype.updateMoves=function(e){this.eventBus.publish(i.UICommands.UPDATE_MOVES,e.toString())},e.prototype.updateShuffles=function(e){this.eventBus.publish(i.UICommands.UPDATE_SHUFFLES,e.toString())},e.prototype.updateBoosters=function(e){this.eventBus.publish(i.UICommands.UPDATE_BOOSTERS,e)},e.prototype.reportMoveResult=function(e){var t={moveResult:e};this.eventBus.publish(i.GameEvents.MOVE_COMPLETED,t)},e.prototype.showGameOver=function(e,t,o){this.eventBus.publish(i.UICommands.SHOW_GAME_OVER,{message:e,finalScore:t,targetScore:o})},e.prototype.hideGameOver=function(){this.eventBus.publish(i.UICommands.HIDE_GAME_OVER)},e.prototype.showMessage=function(e,t){this.toastManager.showInfo(e,t)},e.prototype.setBoosterActive=function(e){this.eventBus.publish(i.UICommands.SET_BOOSTER_ACTIVE,e)},e.prototype.reportShuffleEvent=function(e){this.eventBus.publish(i.UICommands.SHUFFLE_REQUESTED,e)},e.prototype.showScorePopup=function(e,t){if(!(e<=0)){var o=this.coordinateService.gameToWorldPosition(t.row,t.col);this.scorePopupManager.showPointsAt(e,o)}},e}();o.UICommandService=a,cc._RF.pop()},{"../../core/EventBus":"EventBus","../../ui/managers/ScorePopupManager":"ScorePopupManager","../../ui/managers/ToastManager":"ToastManager","../services/CoordinateService":"CoordinateService"}],UIController:[function(e,t,o){"use strict";cc._RF.push(t,"1b2dfncSLlMMaX4pLB5/yjm","UIController"),Object.defineProperty(o,"__esModule",{value:!0}),o.UIController=void 0;var i=e("./EventBus"),n=function(){function e(e){this.gameController=e,this.eventBus=i.EventBus.getInstance(),this.setupEventListeners()}return e.prototype.setupEventListeners=function(){this.eventBus.subscribe(i.GameEvents.ANIMATION_COMPLETED,this.onAnimationCompleted,this),this.eventBus.subscribe(i.GameEvents.NEED_SHUFFLE,this.gameController.handleNeedShuffle,this.gameController),this.eventBus.subscribe(i.GameEvents.HINT_REQUEST,this.gameController.handleHintRequest,this.gameController),this.eventBus.subscribe(i.GameEvents.TILE_CLICKED,this.onUITileClicked,this),this.eventBus.subscribe(i.GameEvents.BOOSTER_ACTIVATION_REQUESTED,this.onUIBoosterActivationRequested,this),this.eventBus.subscribe(i.GameEvents.BOOSTER_DEACTIVATION_REQUESTED,this.onUIBoosterDeactivationRequested,this),this.eventBus.subscribe(i.GameEvents.SHUFFLE_REQUESTED,this.onUIShuffleRequested,this)},e.prototype.onAnimationCompleted=function(){this.gameController.checkPendingGameState(),this.gameController.updateUI()},e.prototype.onUITileClicked=function(e,t){this.gameController.handleTileClick(e,t)},e.prototype.onUIBoosterActivationRequested=function(e){this.gameController.activateBooster(e)},e.prototype.onUIBoosterDeactivationRequested=function(){this.gameController.deactivateBooster()},e.prototype.onUIShuffleRequested=function(){this.gameController.requestShuffle()},e.prototype.destroy=function(){this.eventBus.unsubscribe(i.GameEvents.ANIMATION_COMPLETED,this.onAnimationCompleted,this),this.eventBus.unsubscribe(i.GameEvents.NEED_SHUFFLE,this.gameController.handleNeedShuffle,this),this.eventBus.unsubscribe(i.GameEvents.HINT_REQUEST,this.gameController.handleHintRequest,this),this.eventBus.unsubscribe(i.GameEvents.TILE_CLICKED,this.onUITileClicked,this),this.eventBus.unsubscribe(i.GameEvents.BOOSTER_ACTIVATION_REQUESTED,this.onUIBoosterActivationRequested,this),this.eventBus.unsubscribe(i.GameEvents.BOOSTER_DEACTIVATION_REQUESTED,this.onUIBoosterDeactivationRequested,this),this.eventBus.unsubscribe(i.GameEvents.SHUFFLE_REQUESTED,this.onUIShuffleRequested,this)},e}();o.UIController=n,cc._RF.pop()},{"./EventBus":"EventBus"}],UITypes:[function(e,t,o){"use strict";cc._RF.push(t,"a93b4SUsDhJ7IbX0k0iHj7f","UITypes"),Object.defineProperty(o,"__esModule",{value:!0}),o.ScorePopupType=o.ToastType=void 0,function(e){e.SUCCESS="success",e.ERROR="error",e.INFO="info",e.WARNING="warning"}(o.ToastType||(o.ToastType={})),function(e){e.NORMAL="normal",e.BONUS="bonus",e.SUPER="super",e.COMBO="combo"}(o.ScorePopupType||(o.ScorePopupType={})),cc._RF.pop()},{}],ZIndexConstants:[function(e,t,o){"use strict";cc._RF.push(t,"876e8UJNeNGvqkjWNs1KzG9","ZIndexConstants"),Object.defineProperty(o,"__esModule",{value:!0}),o.ZIndexConstants=void 0;var i=function(){function e(){}return e.ANIMATIONS=5e3,e.TOAST_MESSAGES=1e4,e}();o.ZIndexConstants=i,cc._RF.pop()},{}],primitives:[function(e,t,o){"use strict";cc._RF.push(t,"2ae22ZRippOtp42uU5Rf4Ma","primitives"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}],types:[function(e,t,o){"use strict";cc._RF.push(t,"e1f4e8UlTpFjKaZ1fv0GYR+","types"),Object.defineProperty(o,"__esModule",{value:!0}),cc._RF.pop()},{}]},{},["MainScene","EventBus","GameController","GameServiceContainer","ServiceContainer","UIController","types","BoostersTypes","BombBoosterStrategy","SwapBoosterStrategy","TileFactory","TileTypes","BaseTile","RegularTile","BaseSuperTile","SuperAllTile","SuperBombTile","SuperColTile","SuperRowTile","GameTypes","BoosterManager","MovesManager","ScoreManager","UICommandService","BoosterInventory","GameBoard","GameModel","GameState","SuperTileRules","AnimationService","ChainReactionService","CoordinateService","HintService","SwapVisualService","GameConfig","DevConsole","ZIndexConstants","primitives","TileUtils","UITypes","ScorePopupManager","ToastManager","BoardView","BoosterPanel","GameOverView","HeaderPanel","ScorePopupView","ShuffleButton","TileView","ToastView"]);